// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401027: Register word32 fn00401027(Register byte al, Register word32 ecx, Register word32 edx, Register word32 ebx, Register word32 ebp, Register Eq_8 edi, Stack Eq_8 dwArg00, Register out ptr32 ebpOut)
word32 fn00401027(byte al, word32 ecx, word32 edx, word32 ebx, word32 ebp, Eq_8 edi, Eq_8 dwArg00, ptr32 & ebpOut)
{
	while (SZO)
	{
		SZO = cond(SLICE(dwArg00, byte, 8) & *dwArg00);
		__cli();
		dwArg00 = edi;
	}
	ptr32 esp_42;
	byte SZO_43;
	byte SCZO_45;
	byte SCZDOP_46;
	bool O_47;
	byte C_48;
	byte bl_50;
	word32 ebx_52;
	byte ah_53;
	ui32 edx_54;
	byte dh_55;
	word32 edi_56;
	byte bh_57;
	byte D_58;
	byte ch_59;
	struct Eq_36 * ecx_60;
	byte cl_61;
	word32 esi_62;
	struct Eq_39 * ebp_49;
	byte al_44;
	word32 eax_51;
	fn00400FCB();
	return eax_51;
}

// 004117BE: Register Eq_120 Win32CrtStartup()
Eq_120 Win32CrtStartup()
{
	ptr32 esp_19 = fp + ~0x5F;
	Eq_120 eax_21 = CreateFileA(&globals->t4319E2, 0x40000000, 0x02, null, 0x03, 133, 0x00);
	if (eax_21 == ~0x00)
	{
		GetLastError();
		dwLoc20 = CreateFileW(&globals->t431A3E, 0x40000000, 0x01, null, 0x03, 0xA2, 0x00);
		GetLastError();
		esp_19 = fp + ~0x7B;
	}
	do
	{
		ptr32 esp_190;
		ptr32 esp_231;
		Eq_120 eax_297;
		union Eq_120 * esp_45 = esp_19 - 0x04;
		*esp_45 = (union Eq_120 *) eax_21;
		CloseHandle(*esp_45);
		GetCommandLineA();
		*(esp_45 - 0x04) = 0x00;
		*(esp_45 - 0x08) = 0x0122;
		*(esp_45 - 0x0C) = 0x03;
		*(esp_45 - 0x10) = 0x00;
		*(esp_45 - 0x14) = 0x03;
		*(esp_45 - 0x18) = 0x80000000;
		*(esp_45 - 0x1C) = 0x00431A31;
		ptr32 esp_104 = esp_45 - 0x1C;
		Eq_120 eax_63 = CreateFileW(*(esp_45 - 0x1C), *(esp_45 - 0x18), *(esp_45 - 0x14), *(esp_45 - 0x10), *(esp_45 - 0x0C), *(esp_45 - 0x08), *(esp_45 - 0x04));
		if (eax_63 != ~0x00)
			goto l004119C5;
		GetCommandLineA();
		*(esp_45 - 0x20) = (union Eq_120 *) dwLoc20;
		GetFileType(*(esp_45 - 0x20));
		*(esp_45 - 0x24) = 0x00;
		*(esp_45 - 0x28) = 0x82;
		*(esp_45 - 44) = 0x03;
		*(esp_45 - 0x30) = 0x00;
		*(esp_45 - 0x34) = 0x00;
		*(esp_45 - 0x38) = 0x80000000;
		*(esp_45 - 0x3C) = 4397579;
		Eq_120 eax_429 = CreateFileA(*(esp_45 - 0x3C), *(esp_45 - 0x38), *(esp_45 - 0x34), *(esp_45 - 0x30), *(esp_45 - 44), *(esp_45 - 0x28), *(esp_45 - 0x24));
		esp_19 = esp_45 - 0x3C;
		dwLoc44 = eax_429;
	} while (eax_429 != ~0x00);
	*(esp_45 - 0x40) = (union Eq_120 *) dwLoc20;
	CloseHandle(*(esp_45 - 0x40));
	*(esp_45 - 0x44) = 0x00;
	*(esp_45 - 0x48) = (union Eq_120 *) eax_63;
	GetFileSize(*(esp_45 - 0x48), *(esp_45 - 0x44));
	*(esp_45 - 0x4C) = (union Eq_120 *) dwLoc20;
	GetFileType(*(esp_45 - 0x4C));
	*(esp_45 - 0x50) = 0x00;
	*(esp_45 - 0x54) = (union Eq_120 *) eax_21;
	GetFileSize(*(esp_45 - 0x54), *(esp_45 - 0x50));
	GetLastError();
	*(esp_45 - 88) = 4397557;
	*(esp_45 - 0x5C) = (union Eq_120 *) dwLoc20;
	GetFileType(*(esp_45 - 0x5C));
	esp_190 = esp_45 - 0x5C;
	dwLoc3C = GetModuleHandleA(*(esp_45 - 0x5C));
l00411910:
	LPDWORD * esp_404 = esp_190 - 0x04;
	*esp_404 = (LPDWORD *) null;
	*(esp_404 - 0x04) = (union Eq_120 *) eax_63;
	GetFileSize(*(esp_404 - 0x04), *esp_404);
	esp_231 = esp_404 - 0x04;
	do
	{
		word32 * esp_316 = esp_231 - 0x04;
		*esp_316 = 4397661;
		GetLastError();
		GetLastError();
		*(esp_316 - 0x04) = (HMODULE *) dwLoc3C;
		*(esp_316 - 0x08) = 0x00;
		*(esp_316 - 0x0C) = (union Eq_120 *) dwLoc44;
		GetFileSize(*(esp_316 - 0x0C), *(esp_316 - 0x08));
		Eq_794 eax_329 = GetProcAddress(*(esp_316 - 0x0C), *(esp_316 - 0x08));
		*(esp_316 - 0x10) = (union Eq_120 *) dwLoc44;
		CloseHandle(*(esp_316 - 0x10));
		*(esp_316 - 0x14) = (union Eq_120 *) dwLoc20;
		CloseHandle(*(esp_316 - 0x14));
		*(esp_316 - 0x18) = 0x00;
		*(esp_316 - 0x1C) = 0x87;
		*(esp_316 - 0x20) = 0x03;
		*(esp_316 - 0x24) = 0x00;
		*(esp_316 - 0x28) = 0x05;
		*(esp_316 - 44) = 0x60000000;
		*(esp_316 - 0x30) = 0x004319C8;
		eax_297 = CreateFileA(*(esp_316 - 0x30), *(esp_316 - 44), *(esp_316 - 0x28), *(esp_316 - 0x24), *(esp_316 - 0x20), *(esp_316 - 0x1C), *(esp_316 - 0x18));
		dwLoc38 = eax_297;
		if (eax_297 != ~0x00)
			return eax_297;
		GetCommandLineA();
		*(esp_316 - 0x34) = 0x00;
		*(esp_316 - 0x38) = (union Eq_120 *) dwLoc20;
		GetFileSize(*(esp_316 - 0x38), *(esp_316 - 0x34));
		*(esp_316 - 0x3C) = 0x00;
		GetLastError();
		*(esp_316 - 0x40) = 0x00;
		esp_104 = esp_316 - 0x40;
		dwLoc2C = eax_329();
l004119C5:
		union Eq_120 * esp_111 = esp_104 - 0x04;
		*esp_111 = (union Eq_120 *) eax_21;
		GetFileType(*esp_111);
		*(esp_111 - 0x04) = 0x00;
		*(esp_111 - 0x08) = 161;
		*(esp_111 - 0x0C) = 0x03;
		*(esp_111 - 0x10) = 0x00;
		*(esp_111 - 0x14) = 0x00;
		*(esp_111 - 0x18) = 0x80000000;
		*(esp_111 - 0x1C) = 4397489;
		Eq_120 eax_131 = CreateFileW(*(esp_111 - 0x1C), *(esp_111 - 0x18), *(esp_111 - 0x14), *(esp_111 - 0x10), *(esp_111 - 0x0C), *(esp_111 - 0x08), *(esp_111 - 0x04));
		ptr32 esp_143;
		word32 ebp_144;
		byte SCZO_145;
		word32 eax_146;
		byte Z_147;
		byte SZO_148;
		byte C_149;
		byte al_150;
		word32 ecx_151;
		word32 edx_152;
		word32 ebx_153;
		word32 edi_154;
		(*((word32) (dwLoc2C ^ 0xC0000008) + 4266528))();
		*(esp_143 - 0x04) = 0x00;
		*(esp_143 - 0x08) = 0x0103;
		*(esp_143 - 0x0C) = 0x03;
		*(esp_143 - 0x10) = 0x00;
		*(esp_143 - 0x14) = 0x01;
		*(esp_143 - 0x18) = 0x20000000;
		*(esp_143 - 0x1C) = 4397500;
		Eq_120 eax_169 = CreateFileA(*(esp_143 - 0x1C), *(esp_143 - 0x18), *(esp_143 - 0x14), *(esp_143 - 0x10), *(esp_143 - 0x0C), *(esp_143 - 0x08), *(esp_143 - 0x04));
		*(esp_143 - 0x20) = fp - 0x08;
		GetLastError();
		*(esp_143 - 0x24) = 0x40;
		GetLastError();
		*(esp_143 - 0x28) = 0x00;
		*(esp_143 - 44) = 0x27;
		*(esp_143 - 0x30) = 0x03;
		*(esp_143 - 0x34) = 0x00;
		*(esp_143 - 0x38) = 0x04;
		*(esp_143 - 0x3C) = 0xA0000000;
		*(esp_143 - 0x40) = 0x004319A9;
		esp_190 = esp_143 - 0x40;
		if (CreateFileW(*(esp_143 - 0x40), *(esp_143 - 0x3C), *(esp_143 - 0x38), *(esp_143 - 0x34), *(esp_143 - 0x30), *(esp_143 - 44), *(esp_143 - 0x28)) != ~0x00)
			goto l00411910;
		*(esp_143 - 0x44) = 67500;
		*(esp_143 - 0x48) = 0x00401000;
		*(esp_143 - 0x4C) = 0x00;
		*(esp_143 - 0x50) = (union Eq_120 *) dwLoc44;
		GetFileSize(*(esp_143 - 0x50), *(esp_143 - 0x4C));
		*(esp_143 - 0x54) = 0x00;
		*(esp_143 - 88) = (union Eq_120 *) dwLoc38;
		GetFileSize(*(esp_143 - 88), *(esp_143 - 0x54));
		VirtualProtect(*(esp_143 - 88), *(esp_143 - 0x54), *(esp_143 - 0x50), *(esp_143 - 0x4C));
		*(esp_143 - 0x5C) = 0x00401000;
		*(esp_143 - 0x60) = (union Eq_120 *) eax_169;
		CloseHandle(*(esp_143 - 0x60));
		*(esp_143 - 100) = 0x00;
		*(esp_143 - 0x68) = 0x0180;
		*(esp_143 - 0x6C) = 0x03;
		*(esp_143 - 0x70) = 0x00;
		*(esp_143 - 116) = 0x06;
		*(esp_143 - 0x78) = 0x40000000;
		*(esp_143 - 0x7C) = 0x00431A25;
		esp_231 = esp_143 - 0x7C;
	} while (CreateFileA(*(esp_143 - 0x7C), *(esp_143 - 0x78), *(esp_143 - 116), *(esp_143 - 0x70), *(esp_143 - 0x6C), *(esp_143 - 0x68), *(esp_143 - 100)) != ~0x00);
	*(esp_143 - 0x80) = (union Eq_376 *) dwLoc2C;
	*(esp_143 - 0x84) = 67500;
	*(esp_143 - 0x88) = 0x00;
	*(esp_143 - 0x8C) = 0x0103;
	*(esp_143 - 0x90) = 0x03;
	*(esp_143 - 0x94) = 0x00;
	*(esp_143 - 0x98) = 0x06;
	*(esp_143 - 0x9C) = 0xA0000000;
	*(esp_143 - 0xA0) = 4397451;
	CreateFileA(*(esp_143 - 0xA0), *(esp_143 - 0x9C), *(esp_143 - 0x98), *(esp_143 - 0x94), *(esp_143 - 0x90), *(esp_143 - 0x8C), *(esp_143 - 0x88));
	*(esp_143 - 0xA4) = 0x00;
	*(esp_143 - 0xA8) = 0x23;
	*(esp_143 - 0xAC) = 0x03;
	*(esp_143 - 0xB0) = 0x00;
	*(esp_143 - 0xB4) = 0x06;
	*(esp_143 - 0xB8) = 0x80000000;
	*(esp_143 - 188) = 0x004319FF;
	CreateFileW(*(esp_143 - 188), *(esp_143 - 0xB8), *(esp_143 - 0xB4), *(esp_143 - 0xB0), *(esp_143 - 0xAC), *(esp_143 - 0xA8), *(esp_143 - 0xA4));
	Eq_163 eax_281 = GetCommandLineA();
	word32 esp_282;
	word32 ebp_283;
	byte SCZO_284;
	word32 eax_285;
	byte Z_286;
	byte SZO_287;
	byte C_288;
	byte al_289;
	word32 ecx_290;
	word32 edx_291;
	word32 ebx_292;
	Eq_8 edi_293;
	(dwLoc2C - ~0x40411B98)();
	word32 ebp_296;
	eax_297 = fn00401027((byte) GetCommandLineA(), ecx_290, edx_291, ebx_292, ebp_283, edi_293, ebp, out ebp_296);
	return eax_297;
}

