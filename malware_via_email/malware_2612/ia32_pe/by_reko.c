// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401025: Register ui32 fn00401025(Register byte al, Register word32 ecx, Register byte dl, Register word32 ebx, Register word32 edi)
ui32 fn00401025(byte al, word32 ecx, byte dl, word32 ebx, word32 edi)
{
	byte al_10 = (byte) (eax | 4088512071);
	__outb(188, al_10);
	ptr32 esp_19;
	byte dl_20;
	word32 ecx_21;
	byte SZO_22;
	byte C_23;
	word32 eax_24;
	word32 esi_25;
	byte ch_26;
	byte al_27;
	byte Z_28;
	byte bl_29;
	byte * ebx_30;
	byte SCZO_31;
	word16 dx_32;
	word32 * edi_33;
	struct Eq_42 * cs_34;
	fn00400FF7();
	return eax_24;
}

// 00415286: Register Eq_83 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetCommandLineA();
	ptr32 esp_414 = fp - 0x48;
l00415292:
	ptr32 esp_372;
	struct Eq_199 * esp_129;
	GetCommandLineA();
	GetLastError();
	HANDLE * esp_57 = esp_414 - 0x04;
	*esp_57 = (HANDLE *) null;
	*(esp_57 - 0x04) = 0x01A5;
	*(esp_57 - 0x08) = 0x03;
	*(esp_57 - 0x0C) = 0x00;
	*(esp_57 - 0x10) = 0x05;
	*(esp_57 - 0x14) = 0x20000000;
	*(esp_57 - 0x18) = 4401666;
	ptr32 esp_260 = esp_57 - 0x18;
	Eq_99 eax_71 = CreateFileA(*(esp_57 - 0x18), *(esp_57 - 0x14), *(esp_57 - 0x10), *(esp_57 - 0x0C), *(esp_57 - 0x08), *(esp_57 - 0x04), *esp_57);
	if (eax_71 == (void *) ~0x00)
	{
		*(esp_57 - 0x1C) = 0x00;
		*(esp_57 - 0x20) = 0x00;
		*(esp_57 - 0x24) = 0x03;
		*(esp_57 - 0x28) = 0x00;
		*(esp_57 - 44) = 0x00;
		ptr32 esp_508 = esp_57 - 44;
		do
		{
			struct Eq_281 * esp_511 = esp_508 - 0x04;
			esp_511->t0000 = 0xE0000000;
			*(esp_511 - 0x04) = 4401747;
			dwLoc08 = CreateFileW(*(esp_511 - 0x04), esp_511->t0000, esp_511->t0004, esp_511->t0008, esp_511->t000C, esp_511->t0010, esp_511->t0014);
			*(esp_511 - 0x08) = 0x00;
			*(esp_511 - 0x0C) = 0x00;
			*(esp_511 - 0x10) = 0x03;
			*(esp_511 - 0x14) = 0x00;
			*(esp_511 - 0x18) = 0x06;
			*(esp_511 - 0x1C) = 0x40000000;
			*(esp_511 - 0x20) = 4401869;
			Eq_99 eax_531 = CreateFileA(*(esp_511 - 0x20), *(esp_511 - 0x1C), *(esp_511 - 0x18), *(esp_511 - 0x14), *(esp_511 - 0x10), *(esp_511 - 0x0C), *(esp_511 - 0x08));
			esp_508 = esp_511 - 0x20;
			dwLoc18 = eax_531;
		} while (eax_531 != (void *) ~0x00);
		*(esp_511 - 0x24) = 0x00;
		esp_372 = esp_511 - 0x24;
l00415331:
		struct Eq_616 * esp_481 = esp_372 - 0x04;
		esp_481->t0000 = 0x86;
		*(esp_481 - 0x04) = 0x03;
		*(esp_481 - 0x08) = 0x00;
		*(esp_481 - 0x0C) = 0x07;
		*(esp_481 - 0x10) = 0x00;
		*(esp_481 - 0x14) = 4401849;
		dwLoc3C = CreateFileA(*(esp_481 - 0x14), *(esp_481 - 0x10), *(esp_481 - 0x0C), *(esp_481 - 0x08), *(esp_481 - 0x04), esp_481->t0000, esp_481->t0004);
		GetLastError();
		*(esp_481 - 0x18) = (HANDLE *) dwLoc18;
		CloseHandle(*(esp_481 - 0x18));
		esp_129 = esp_481 - 0x18;
		do
		{
			GetLastError();
			HANDLE * esp_289 = esp_129 - 0x04;
			*esp_289 = (HANDLE *) dwLoc08;
			CloseHandle(*esp_289);
			*(esp_289 - 0x04) = (HANDLE *) dwLoc3C;
			CloseHandle(*(esp_289 - 0x04));
			*(esp_289 - 0x08) = (HANDLE *) dwLoc08;
			GetFileType(*(esp_289 - 0x08));
			*(esp_289 - 0x0C) = 0x00;
			*(esp_289 - 0x10) = (HANDLE *) dwLoc3C;
			GetFileSize(*(esp_289 - 0x10), *(esp_289 - 0x0C));
			*(esp_289 - 0x14) = 4401737;
			*(esp_289 - 0x18) = (HANDLE *) dwLoc08;
			GetFileType(*(esp_289 - 0x18));
			Eq_432 eax_312 = GetModuleHandleA(*(esp_289 - 0x18));
			*(esp_289 - 0x1C) = 0x00;
			*(esp_289 - 0x20) = 0x84;
			*(esp_289 - 0x24) = 0x03;
			*(esp_289 - 0x28) = 0x00;
			*(esp_289 - 44) = 0x00;
			*(esp_289 - 0x30) = 0x60000000;
			*(esp_289 - 0x34) = 0x00432A0E;
			dwLoc20 = CreateFileW(*(esp_289 - 0x34), *(esp_289 - 0x30), *(esp_289 - 44), *(esp_289 - 0x28), *(esp_289 - 0x24), *(esp_289 - 0x20), *(esp_289 - 0x1C));
			*(esp_289 - 0x38) = 4401878;
			ptr32 esp_330 = esp_289 - 0x38;
			do
			{
				HANDLE * esp_334 = esp_330 - 0x04;
				*esp_334 = (HANDLE *) dwLoc18;
				GetFileType(*esp_334);
				*(esp_334 - 0x04) = (HMODULE *) eax_312;
				*(esp_334 - 0x08) = 0x00;
				*(esp_334 - 0x0C) = 0x02;
				*(esp_334 - 0x10) = 0x03;
				*(esp_334 - 0x14) = 0x00;
				*(esp_334 - 0x18) = 0x07;
				*(esp_334 - 0x1C) = 0xE0000000;
				*(esp_334 - 0x20) = 4401718;
				esp_330 = esp_334 - 0x20;
			} while (CreateFileW(*(esp_334 - 0x20), *(esp_334 - 0x1C), *(esp_334 - 0x18), *(esp_334 - 0x14), *(esp_334 - 0x10), *(esp_334 - 0x0C), *(esp_334 - 0x08)) != (void *) ~0x00);
			dwLoc2C = GetProcAddress(*(esp_334 - 0x20), *(esp_334 - 0x1C));
			*(esp_334 - 0x24) = 0x00;
			*(esp_334 - 0x28) = 0x01;
			*(esp_334 - 44) = 0x03;
			*(esp_334 - 0x30) = 0x00;
			*(esp_334 - 0x34) = 0x05;
			*(esp_334 - 0x38) = 0xE0000000;
			*(esp_334 - 0x3C) = 4401646;
			Eq_99 eax_374 = CreateFileW(*(esp_334 - 0x3C), *(esp_334 - 0x38), *(esp_334 - 0x34), *(esp_334 - 0x30), *(esp_334 - 44), *(esp_334 - 0x28), *(esp_334 - 0x24));
			esp_372 = esp_334 - 0x3C;
			dwLoc44 = eax_374;
			if (eax_374 != (void *) ~0x00)
				goto l00415331;
			*(esp_334 - 0x40) = (HANDLE *) dwLoc08;
			CloseHandle(*(esp_334 - 0x40));
			*(esp_334 - 0x44) = (HANDLE *) dwLoc3C;
			GetFileType(*(esp_334 - 0x44));
			*(esp_334 - 0x48) = 0x00;
			*(esp_334 - 0x4C) = 0x03;
			*(esp_334 - 0x50) = 0x03;
			*(esp_334 - 0x54) = 0x00;
			*(esp_334 - 88) = 0x05;
			*(esp_334 - 0x5C) = 0x20000000;
			*(esp_334 - 0x60) = 4401818;
			CreateFileA(*(esp_334 - 0x60), *(esp_334 - 0x5C), *(esp_334 - 88), *(esp_334 - 0x54), *(esp_334 - 0x50), *(esp_334 - 0x4C), *(esp_334 - 0x48));
			*(esp_334 - 100) = 0x00;
			*(esp_334 - 0x68) = 0x24;
			*(esp_334 - 0x6C) = 0x03;
			*(esp_334 - 0x70) = 0x00;
			*(esp_334 - 116) = 0x01;
			*(esp_334 - 0x78) = 0x80000000;
			*(esp_334 - 0x7C) = 4401906;
			Eq_99 eax_416 = CreateFileA(*(esp_334 - 0x7C), *(esp_334 - 0x78), *(esp_334 - 116), *(esp_334 - 0x70), *(esp_334 - 0x6C), *(esp_334 - 0x68), *(esp_334 - 100));
			esp_414 = esp_334 - 0x7C;
			dwLoc28 = eax_416;
			if (eax_416 != (void *) ~0x00)
				goto l00415292;
			*(esp_334 - 0x80) = 0x00;
			*(esp_334 - 0x84) = 0x00;
			*(esp_334 - 0x88) = 262;
			*(esp_334 - 0x8C) = 0x03;
			*(esp_334 - 0x90) = 0x00;
			*(esp_334 - 0x94) = 0x01;
			*(esp_334 - 0x98) = 0x20000000;
			*(esp_334 - 0x9C) = 4401691;
			dwLoc10 = CreateFileA(*(esp_334 - 0x9C), *(esp_334 - 0x98), *(esp_334 - 0x94), *(esp_334 - 0x90), *(esp_334 - 0x8C), *(esp_334 - 0x88), *(esp_334 - 0x84));
			*(esp_334 - 0xA0) = 0x00;
			*(esp_334 - 0xA4) = 0x00;
			*(esp_334 - 0xA8) = 0x00;
			*(esp_334 - 0xAC) = 0x0182;
			*(esp_334 - 0xB0) = 0x03;
			*(esp_334 - 0xB4) = 0x00;
			*(esp_334 - 0xB8) = 0x03;
			*(esp_334 - 188) = 0xE0000000;
			*(esp_334 - 0xC0) = 4401766;
			esp_129 = esp_334 - 0xC0;
l00415534:
			Eq_99 eax_231 = CreateFileA(esp_129->t0000, esp_129->t0004, esp_129->t0008, esp_129->t000C, esp_129->t0010, esp_129->t0014, esp_129->t0018);
		} while (eax_231 != (void *) ~0x00);
		ptr32 esp_236;
		word32 ebp_237;
		byte SCZO_238;
		ptr32 eax_239;
		byte Z_240;
		byte SZO_241;
		byte C_242;
		byte al_243;
		word32 ecx_244;
		byte dl_245;
		word32 ebx_246;
		word32 edi_247;
		dwLoc2C();
		*(esp_236 - 0x04) = (HANDLE *) eax_231;
		GetFileType(*(esp_236 - 0x04));
		*(esp_236 - 0x08) = (HANDLE *) eax_71;
		CloseHandle(*(esp_236 - 0x08));
		dwLoc1C = eax_239;
		dwLoc14 = eax_239 ^ 0xC0000005;
		esp_260 = esp_236 - 0x08;
	}
	LPDWORD * esp_90 = esp_260 - 0x04;
	*esp_90 = (LPDWORD *) null;
	*(esp_90 - 0x04) = (HANDLE *) dwLoc20;
	GetFileSize(*(esp_90 - 0x04), *esp_90);
	*(esp_90 - 0x08) = 0x00;
	*(esp_90 - 0x0C) = (HANDLE *) dwLoc44;
	<anonymous> * v23_96 = (char *) dwLoc14 + 0x004155B1;
	dwLoc14 = v23_96;
	Eq_83 eax_104 = GetFileSize(*(esp_90 - 0x0C), *(esp_90 - 0x08));
	ptr32 esp_105;
	word32 ebp_106;
	byte SCZO_107;
	word32 eax_108;
	byte Z_109;
	byte SZO_110;
	byte C_111;
	byte al_112;
	word32 ecx_113;
	byte dl_114;
	word32 ebx_115;
	word32 edi_116;
	v23_96();
	*(esp_105 - 0x04) = 0x00;
	*(esp_105 - 0x08) = 288;
	*(esp_105 - 0x0C) = 0x03;
	*(esp_105 - 0x10) = 0x00;
	*(esp_105 - 0x14) = 0x04;
	*(esp_105 - 0x18) = 0xA0000000;
	*(esp_105 - 0x1C) = 0x00432A80;
	esp_129 = esp_105 - 0x1C;
	if (CreateFileW(*(esp_105 - 0x1C), *(esp_105 - 0x18), *(esp_105 - 0x14), *(esp_105 - 0x10), *(esp_105 - 0x0C), *(esp_105 - 0x08), *(esp_105 - 0x04)) == (void *) ~0x00)
	{
		GetCommandLineA();
		*(esp_105 - 0x20) = fp - 0x34;
		*(esp_105 - 0x24) = 0x40;
		*(esp_105 - 0x28) = 0x00014281;
		*(esp_105 - 44) = 0x00401000;
		*(esp_105 - 0x30) = 0x00;
		*(esp_105 - 0x34) = (HANDLE *) eax_71;
		GetFileSize(*(esp_105 - 0x34), *(esp_105 - 0x30));
		GetLastError();
		VirtualProtect(*(esp_105 - 0x34), *(esp_105 - 0x30), *(esp_105 - 44), *(esp_105 - 0x28));
		*(esp_105 - 0x38) = 0x00;
		*(esp_105 - 0x3C) = (HANDLE *) dwLoc28;
		GetFileSize(*(esp_105 - 0x3C), *(esp_105 - 0x38));
		*(esp_105 - 0x40) = 0x00401000;
		*(esp_105 - 0x44) = (HANDLE *) eax_71;
		CloseHandle(*(esp_105 - 0x44));
		*(esp_105 - 0x48) = dwLoc1C;
		*(esp_105 - 0x4C) = 0x00014281;
		GetLastError();
		*(esp_105 - 0x50) = (HANDLE *) dwLoc44;
		CloseHandle(*(esp_105 - 0x50));
		*(esp_105 - 0x54) = 0x00;
		*(esp_105 - 88) = (HANDLE *) dwLoc10;
		Eq_83 eax_184 = GetFileSize(*(esp_105 - 88), *(esp_105 - 0x54));
		ptr32 esp_188;
		word32 ebp_189;
		byte SCZO_190;
		word32 eax_191;
		byte Z_192;
		byte SZO_193;
		byte C_194;
		byte al_195;
		word32 ecx_196;
		byte dl_197;
		word32 ebx_198;
		word32 edi_199;
		(dwLoc1C - 3216943442)();
		*(esp_188 - 0x04) = (HANDLE *) eax_71;
		return fn00401025((byte) CloseHandle(*(esp_188 - 0x04)), ecx_196, dl_197, ebx_198, edi_199);
	}
	goto l00415534;
}

