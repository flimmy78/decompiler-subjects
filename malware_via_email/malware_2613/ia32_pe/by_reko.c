// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00425597: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	GetOEMCP();
	GetACP();
	Eq_9 eax_27 = LoadLibraryA(&globals->t43400E);
	GetCommandLineA();
	GetOEMCP();
	GetProcAddress(eax_27, &globals->t43403B)();
	CreateFileA(&globals->t434018, 0xC0000000, 0x01, null, 0x03, 0xA3, 0x00);
	CreateFileA(&globals->t434021, 0xE0000000, 0x06, null, 0x03, 0x26, 0x00);
	GetCommandLineW();
	ptr32 * ebp_89;
	word16 dx_90 = fn004257CC(dwArg00, dwArg04, dwArg08, out ebp_89);
	*(ebp_89 - 0x20) = (LPSTR *) GetCommandLineA();
	SizeofResource(null, *(ebp_89 - 0x1C));
	CloseHandle(*(ebp_89 - 0x1C));
	GetCurrentProcessId();
	Eq_2 v11_110 = *(ebp_89 - 0x1C);
	GetFileType(v11_110);
	GetCurrentProcessId();
	*(ebp_89 - 0x18) = (LPSTR *) GetCommandLineA();
	VirtualProtect(&globals->v42A000, 0x9401, v11_110, (DWORD *) 0x40);
	GetOEMCP();
	Eq_2 v12_127 = *(ebp_89 - 0x1C);
	GetFileSize(v12_127, null);
	SizeofResource(null, *(ebp_89 - 0x1C));
	GetOEMCP();
	GetCommandLineW();
	GetFileSize(*(ebp_89 - 0x10), null);
	ptr32 ebp_150 = *ebp_89;
	Eq_2 eax_152 = GetCurrentThreadId();
	byte al_153 = (byte) eax_152;
	byte al_154;
	__daa(al_153, &al_154);
	__outb(dx_90, al_154);
	*v12_127 = __in(dx_90);
	*((word32) v12_127 + 0x04) = __in(dx_90);
	__outb(dx_90, al_154);
	word32 esp_170;
	word32 ebp_171;
	byte SCZO_172;
	word32 ebx_173;
	word32 edi_174;
	word32 esi_175;
	Eq_2 eax_176;
	byte C_177;
	byte al_178;
	word16 dx_179;
	byte SZO_180;
	(*(ebp_150 - 0x52))();
	return eax_176;
}

// 004257CC: Register word16 fn004257CC(Stack (ptr word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C, Register out ptr32 ebpOut)
word16 fn004257CC(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C, ptr32 & ebpOut)
{
	word32 * edx_17 = dwArg04;
	uint32 esi_21 = dwArg08 >> 0x02;
	do
	{
		*edx_17 = *edx_17 - dwArg0C;
		*edx_17 = *edx_17 - ~0x323E3816;
		*edx_17 = __ror(*edx_17, 171);
		*edx_17 = __rol(*edx_17, 0x03);
		*edx_17 = -*edx_17;
		*edx_17 = __rol(*edx_17, 0xAA);
		*edx_17 = *edx_17 ^ 2140726636;
		edx_17 = edx_17 + 0x01;
		word16 dx_44 = (word16) edx_17;
		esi_21 = esi_21 - 0x01;
	} while (esi_21 != 0x00);
	word32 ebp_55;
	*ebpOut = ebp;
	return dx_44;
}

