// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401027: Register word32 fn00401027(Register byte ch, Register byte dl, Register (ptr int32) ebx, Register (ptr Eq_6) edi, FpuStack real64 rArg0, FpuStack out Eq_8 rArg0Out)
word32 fn00401027(byte ch, byte dl, int32 * ebx, Eq_6 * edi, real64 rArg0, Eq_8 & rArg0Out)
{
	ui32 edx_4 = DPB(edx, ~0x09, 8);
	null[edx_4].ptr0000 = gs;
	*ebx = (int32) rArg0;
	if (Z)
	{
		edi->b0000 = edi->b0000 + ch + C;
		edi->dw004D = edi->dw004D + ~0x38;
	}
	else
	{
		word32 esp_17;
		byte dh_18;
		word32 eax_19;
		word32 edx_20;
		struct Eq_44 * gs_21;
		word32 ebx_22;
		byte Z_23;
		byte al_24;
		byte C_25;
		word32 edi_26;
		byte ch_27;
		byte SCZO_28;
		byte SZO_29;
		struct Eq_53 * es_30;
		byte dl_31;
		fn00400FF1();
		return eax_19;
	}
}

// 00414671: Register Eq_57 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	Eq_58 eax_22 = CreateFileW(&globals->t42EC89, 0x00, 0x00, null, 0x03, 0x01A3, null);
	GetCommandLineA();
	ptr32 esp_20 = fp - 0x68;
l004146A6:
	HANDLE * esp_65 = esp_20 - 0x04;
	*esp_65 = (HANDLE *) null;
	*(esp_65 - 0x04) = 0x01A4;
	*(esp_65 - 0x08) = 0x03;
	*(esp_65 - 0x0C) = 0x00;
	*(esp_65 - 0x10) = 0x04;
	*(esp_65 - 0x14) = 0x20000000;
	*(esp_65 - 0x18) = 4385754;
	ptr32 esp_122 = esp_65 - 0x18;
	Eq_58 eax_79 = CreateFileA(*(esp_65 - 0x18), *(esp_65 - 0x14), *(esp_65 - 0x10), *(esp_65 - 0x0C), *(esp_65 - 0x08), *(esp_65 - 0x04), *esp_65);
	if (eax_79 == (void *) ~0x00)
	{
		GetCommandLineA();
		*(esp_65 - 0x1C) = (HANDLE *) eax_22;
		GetFileType(*(esp_65 - 0x1C));
		*(esp_65 - 0x20) = 0x00;
		*(esp_65 - 0x24) = 0x0105;
		*(esp_65 - 0x28) = 0x03;
		*(esp_65 - 44) = 0x00;
		ptr32 esp_171 = esp_65 - 44;
		do
		{
			struct Eq_388 * esp_196 = esp_171 - 0x04;
			esp_196->t0000 = 0x04;
			*(esp_196 - 0x04) = 0x00;
			*(esp_196 - 0x08) = 0x0042EC4E;
			ptr32 esp_200 = esp_196 - 0x08;
			Eq_58 eax_202 = CreateFileW(*(esp_196 - 0x08), *(esp_196 - 0x04), esp_196->t0000, esp_196->t0004, esp_196->t0008, esp_196->t000C, esp_196->t0010);
l0041470F:
			LPDWORD * esp_224 = esp_200 - 0x04;
			*esp_224 = (LPDWORD *) null;
			*(esp_224 - 0x04) = (HANDLE *) eax_79;
			GetFileSize(*(esp_224 - 0x04), *esp_224);
			*(esp_224 - 0x08) = 0x00;
			*(esp_224 - 0x0C) = (HANDLE *) eax_529;
			GetFileSize(*(esp_224 - 0x0C), *(esp_224 - 0x08));
			*(esp_224 - 0x10) = 0x00;
			*(esp_224 - 0x14) = (HANDLE *) eax_529;
			GetFileSize(*(esp_224 - 0x14), *(esp_224 - 0x10));
			*(esp_224 - 0x18) = 0x00;
			*(esp_224 - 0x1C) = 0x23;
			*(esp_224 - 0x20) = 0x03;
			*(esp_224 - 0x24) = 0x00;
			*(esp_224 - 0x28) = 0x06;
			*(esp_224 - 44) = 0x60000000;
			*(esp_224 - 0x30) = 0x0042EBB4;
			esp_20 = esp_224 - 0x30;
			Eq_58 eax_256 = CreateFileW(*(esp_224 - 0x30), *(esp_224 - 44), *(esp_224 - 0x28), *(esp_224 - 0x24), *(esp_224 - 0x20), *(esp_224 - 0x1C), *(esp_224 - 0x18));
			if (eax_256 != (void *) ~0x00)
				goto l004146A6;
			GetLastError();
			*(esp_224 - 0x34) = 0x00;
			*(esp_224 - 0x38) = 33;
			*(esp_224 - 0x3C) = 0x03;
			*(esp_224 - 0x40) = 0x00;
			*(esp_224 - 0x44) = 0x02;
			*(esp_224 - 0x48) = 0x80000000;
			*(esp_224 - 0x4C) = 0x0042EC6E;
			Eq_58 eax_275 = CreateFileW(*(esp_224 - 0x4C), *(esp_224 - 0x48), *(esp_224 - 0x44), *(esp_224 - 0x40), *(esp_224 - 0x3C), *(esp_224 - 0x38), *(esp_224 - 0x34));
			esp_171 = esp_224 - 0x4C;
			dwLoc3C = eax_275;
		} while (eax_275 != (void *) ~0x00);
		*(esp_224 - 0x50) = (HANDLE *) eax_256;
		CloseHandle(*(esp_224 - 0x50));
		GetCommandLineA();
		GetLastError();
		*(esp_224 - 0x54) = 0x00;
		*(esp_224 - 88) = (HANDLE *) eax_529;
		GetFileSize(*(esp_224 - 88), *(esp_224 - 0x54));
		*(esp_224 - 0x5C) = (HANDLE *) eax_275;
		CloseHandle(*(esp_224 - 0x5C));
		*(esp_224 - 0x60) = 0x00;
		*(esp_224 - 100) = 0x80;
		*(esp_224 - 0x68) = 0x03;
		*(esp_224 - 0x6C) = 0x00;
		*(esp_224 - 0x70) = 0x05;
		*(esp_224 - 116) = 0x00;
		*(esp_224 - 0x78) = 4385837;
		Eq_58 eax_309 = CreateFileA(*(esp_224 - 0x78), *(esp_224 - 116), *(esp_224 - 0x70), *(esp_224 - 0x6C), *(esp_224 - 0x68), *(esp_224 - 100), *(esp_224 - 0x60));
		dwLoc1C = eax_309;
		if (eax_309 != (void *) ~0x00)
		{
			*(esp_224 - 0x7C) = (union Eq_164 *) dwLoc44;
			*(esp_224 - 0x80) = 0x00013612;
			GetLastError();
			GetLastError();
			*(esp_224 - 0x84) = 0x00;
			*(esp_224 - 0x88) = 0x26;
			*(esp_224 - 0x8C) = 0x03;
			*(esp_224 - 0x90) = 0x00;
			*(esp_224 - 0x94) = 0x03;
			*(esp_224 - 0x98) = 0x20000000;
			*(esp_224 - 0x9C) = 0x0042EBAA;
			CreateFileA(*(esp_224 - 0x9C), *(esp_224 - 0x98), *(esp_224 - 0x94), *(esp_224 - 0x90), *(esp_224 - 0x8C), *(esp_224 - 0x88), *(esp_224 - 0x84));
			*(esp_224 - 0xA0) = 0x00;
			*(esp_224 - 0xA4) = (HANDLE *) dwLoc34;
			Eq_57 eax_509 = GetFileSize(*(esp_224 - 0xA4), *(esp_224 - 0xA0));
			word32 esp_513;
			word32 ebp_514;
			byte SCZO_515;
			word32 eax_516;
			byte Z_517;
			byte SZO_518;
			byte C_519;
			byte ch_520;
			byte dl_521;
			int32 * ebx_522;
			struct Eq_6 * edi_523;
			(dwLoc44 - 2143664684)();
			real64 rArg0_524;
			return fn00401027(ch_520, dl_521, ebx_522, edi_523, rArg0, out rArg0_524);
		}
		*(esp_224 - 0x7C) = 4385848;
		*(esp_224 - 0x80) = (HANDLE *) eax_529;
		CloseHandle(*(esp_224 - 0x80));
		Eq_728 eax_319 = LoadLibraryA(*(esp_224 - 0x80));
		*(esp_224 - 0x84) = 0x00;
		*(esp_224 - 0x88) = 0x01A5;
		*(esp_224 - 0x8C) = 0x03;
		esp_122 = esp_224 - 0x8C;
		do
		{
			struct Eq_904 * esp_339 = esp_122 - 0x04;
			esp_339->t0000 = null;
			*(esp_339 - 0x04) = 0x01;
			*(esp_339 - 0x08) = 0x80000000;
			*(esp_339 - 0x0C) = 0x0042EC76;
			Eq_58 eax_347 = CreateFileA(*(esp_339 - 0x0C), *(esp_339 - 0x08), *(esp_339 - 0x04), esp_339->t0000, esp_339->t0004, esp_339->t0008, esp_339->t000C);
			*(esp_339 - 0x10) = 4385736;
			*(esp_339 - 0x14) = (HMODULE *) eax_319;
			*(esp_339 - 0x18) = (HANDLE *) eax_529;
			GetFileType(*(esp_339 - 0x18));
			Eq_1084 eax_358 = GetProcAddress(*(esp_339 - 0x18), *(esp_339 - 0x14));
			GetCommandLineA();
			*(esp_339 - 0x1C) = 0x00;
			*(esp_339 - 0x20) = 0x0122;
			*(esp_339 - 0x24) = 0x03;
			*(esp_339 - 0x28) = 0x00;
			*(esp_339 - 44) = 0x07;
			*(esp_339 - 0x30) = 0xA0000000;
			*(esp_339 - 0x34) = 4385858;
			Eq_58 eax_375 = CreateFileW(*(esp_339 - 0x34), *(esp_339 - 0x30), *(esp_339 - 44), *(esp_339 - 0x28), *(esp_339 - 0x24), *(esp_339 - 0x20), *(esp_339 - 0x1C));
			*(esp_339 - 0x38) = 0x00;
			*(esp_339 - 0x3C) = 0x0102;
			*(esp_339 - 0x40) = 0x03;
			*(esp_339 - 0x44) = 0x00;
			*(esp_339 - 0x48) = 0x05;
			*(esp_339 - 0x4C) = 0xE0000000;
			*(esp_339 - 0x50) = 0x0042EBBA;
			eax_202 = CreateFileA(*(esp_339 - 0x50), *(esp_339 - 0x4C), *(esp_339 - 0x48), *(esp_339 - 0x44), *(esp_339 - 0x40), *(esp_339 - 0x3C), *(esp_339 - 0x38));
			esp_200 = esp_339 - 0x50;
			dwLoc18 = eax_202;
			Eq_58 eax_529 = eax_202;
			if (eax_202 != (void *) ~0x00)
				goto l0041470F;
			*(esp_339 - 0x54) = 0x00;
			*(esp_339 - 88) = 0x0123;
			*(esp_339 - 0x5C) = 0x03;
			*(esp_339 - 0x60) = 0x00;
			*(esp_339 - 100) = 0x05;
			*(esp_339 - 0x68) = 0xE0000000;
			*(esp_339 - 0x6C) = 4385805;
			dwLoc34 = CreateFileW(*(esp_339 - 0x6C), *(esp_339 - 0x68), *(esp_339 - 100), *(esp_339 - 0x60), *(esp_339 - 0x5C), *(esp_339 - 88), *(esp_339 - 0x54));
			*(esp_339 - 0x70) = (HANDLE *) eax_275;
			CloseHandle(*(esp_339 - 0x70));
			GetCommandLineA();
			*(esp_339 - 116) = 0x00;
			*(esp_339 - 0x78) = (HANDLE *) eax_256;
			GetFileSize(*(esp_339 - 0x78), *(esp_339 - 116));
			*(esp_339 - 0x7C) = 0x00;
			*(esp_339 - 0x80) = (HANDLE *) eax_375;
			GetFileType(*(esp_339 - 0x80));
			*(esp_339 - 0x84) = (HANDLE *) eax_309;
			CloseHandle(*(esp_339 - 0x84));
			*(esp_339 - 0x88) = 0x00;
			GetCommandLineA();
			*(esp_339 - 0x8C) = 0x00;
			*(esp_339 - 0x90) = (HANDLE *) eax_347;
			GetFileSize(*(esp_339 - 0x90), *(esp_339 - 0x8C));
			Eq_164 eax_444 = eax_358();
			*(esp_339 - 0x94) = (HANDLE *) eax_529;
			CloseHandle(*(esp_339 - 0x94));
			*(esp_339 - 0x98) = 0x00;
			*(esp_339 - 0x9C) = 0x24;
			*(esp_339 - 0xA0) = 0x03;
			*(esp_339 - 0xA4) = 0x00;
			*(esp_339 - 0xA8) = 0x04;
			*(esp_339 - 0xAC) = 0x00;
			*(esp_339 - 0xB0) = 0x0042EBC0;
			dwLoc44 = eax_444;
			dwLoc48 = eax_444;
			esp_122 = esp_339 - 0xB0;
		} while (CreateFileA(*(esp_339 - 0xB0), *(esp_339 - 0xAC), *(esp_339 - 0xA8), *(esp_339 - 0xA4), *(esp_339 - 0xA0), *(esp_339 - 0x9C), *(esp_339 - 0x98)) != (void *) ~0x00);
	}
	HANDLE * esp_124 = esp_122 - 0x04;
	*esp_124 = (HANDLE *) dwLoc1C;
	CloseHandle(*esp_124);
	GetCommandLineA();
	*(esp_124 - 0x04) = 0x00;
	*(esp_124 - 0x08) = (HANDLE *) dwLoc18;
	GetFileSize(*(esp_124 - 0x08), *(esp_124 - 0x04));
	*(esp_124 - 0x0C) = 0x00;
	*(esp_124 - 0x10) = (HANDLE *) dwLoc3C;
	GetFileSize(*(esp_124 - 0x10), *(esp_124 - 0x0C));
	Eq_57 eax_146 = GetLastError();
	word32 esp_148;
	word32 ebp_149;
	byte SCZO_150;
	Eq_57 eax_151;
	byte Z_152;
	byte SZO_153;
	byte C_154;
	byte ch_155;
	byte dl_156;
	word32 ebx_157;
	word32 edi_158;
	(*((word32) (dwLoc48 ^ 0x80070057) + 0x00414A04))();
	return eax_151;
}

