// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401024: Register word32 fn00401024(Register word32 eax, Register (ptr byte) ecx, Register word16 dx, Register word32 esi, Register (ptr word32) edi, Register out ptr32 ebpOut)
word32 fn00401024(word32 eax, byte * ecx, word16 dx, word32 esi, word32 * edi, ptr32 & ebpOut)
{
	*ecx = *ecx - ch - C;
	__outdw(dx, eax);
	*edi = __in(dx);
	word32 esp_27;
	byte C_28;
	word32 ecx_29;
	byte ch_30;
	byte SCZO_31;
	word16 dx_32;
	word32 eax_33;
	word32 esi_34;
	byte al_35;
	word32 edi_36;
	word32 ebp_37;
	fnAEC62F66();
	return eax_33;
}

// 004151C1: Register Eq_43 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetCommandLineA();
	GetLastError();
	GetCommandLineA();
	ptr32 esp_168 = fp - 0x4C;
l004151D9:
	GetCommandLineA();
	HANDLE * esp_57 = esp_168 - 0x04;
	*esp_57 = (HANDLE *) null;
	*(esp_57 - 0x04) = 0x20;
	*(esp_57 - 0x08) = 0x03;
	*(esp_57 - 0x0C) = 0x00;
	*(esp_57 - 0x10) = 0x04;
	*(esp_57 - 0x14) = 0x80000000;
	*(esp_57 - 0x18) = 4390029;
	Eq_61 eax_71 = CreateFileA(*(esp_57 - 0x18), *(esp_57 - 0x14), *(esp_57 - 0x10), *(esp_57 - 0x0C), *(esp_57 - 0x08), *(esp_57 - 0x04), *esp_57);
	*(esp_57 - 0x1C) = 0x00;
	*(esp_57 - 0x20) = (HANDLE *) eax_71;
	GetFileSize(*(esp_57 - 0x20), *(esp_57 - 0x1C));
	ptr32 esp_102 = esp_57 - 0x20;
	do
	{
		GetLastError();
		HANDLE * esp_105 = esp_102 - 0x04;
		*esp_105 = (HANDLE *) eax_71;
		CloseHandle(*esp_105);
		GetLastError();
		*(esp_105 - 0x04) = (HANDLE *) eax_71;
		GetFileType(*(esp_105 - 0x04));
		*(esp_105 - 0x08) = 0x00;
		*(esp_105 - 0x0C) = 0xA7;
		*(esp_105 - 0x10) = 0x03;
		*(esp_105 - 0x14) = 0x00;
		*(esp_105 - 0x18) = 0x07;
		ptr32 esp_121 = esp_105 - 0x18;
l0041524D:
		struct Eq_1280 * esp_146 = esp_121 - 0x04;
		esp_146->t0000 = 0x80000000;
		*(esp_146 - 0x04) = 4389971;
		ptr32 esp_148 = esp_146 - 0x04;
		Eq_61 eax_150 = CreateFileA(*(esp_146 - 0x04), esp_146->t0000, esp_146->t0004, esp_146->t0008, esp_146->t000C, esp_146->t0010, esp_146->t0014);
		do
		{
			HANDLE * esp_156 = esp_148 - 0x04;
			*esp_156 = (HANDLE *) null;
			*(esp_156 - 0x04) = 0x01A1;
			*(esp_156 - 0x08) = 0x03;
			*(esp_156 - 0x0C) = 0x00;
			*(esp_156 - 0x10) = 0x06;
			*(esp_156 - 0x14) = 0x00;
			*(esp_156 - 0x18) = 4390121;
			esp_168 = esp_156 - 0x18;
			if (CreateFileA(*(esp_156 - 0x18), *(esp_156 - 0x14), *(esp_156 - 0x10), *(esp_156 - 0x0C), *(esp_156 - 0x08), *(esp_156 - 0x04), *esp_156) != (void *) ~0x00)
				goto l004151D9;
			GetCommandLineA();
			*(esp_156 - 0x1C) = 0x00;
			*(esp_156 - 0x20) = 0xA3;
			*(esp_156 - 0x24) = 0x03;
			*(esp_156 - 0x28) = 0x00;
			*(esp_156 - 44) = 0x07;
			*(esp_156 - 0x30) = 0x20000000;
			*(esp_156 - 0x34) = 4389963;
			CreateFileW(*(esp_156 - 0x34), *(esp_156 - 0x30), *(esp_156 - 44), *(esp_156 - 0x28), *(esp_156 - 0x24), *(esp_156 - 0x20), *(esp_156 - 0x1C));
			*(esp_156 - 0x38) = 4389934;
			Eq_267 eax_193 = GetModuleHandleA(*(esp_156 - 0x38));
			*(esp_156 - 0x3C) = 0x00;
			*(esp_156 - 0x40) = 0x82;
			*(esp_156 - 0x44) = 0x03;
			*(esp_156 - 0x48) = 0x00;
			*(esp_156 - 0x4C) = 0x04;
			*(esp_156 - 0x50) = 0xC0000000;
			*(esp_156 - 0x54) = 4389991;
			esp_148 = esp_156 - 0x54;
			Eq_61 eax_209 = CreateFileW(*(esp_156 - 0x54), *(esp_156 - 0x50), *(esp_156 - 0x4C), *(esp_156 - 0x48), *(esp_156 - 0x44), *(esp_156 - 0x40), *(esp_156 - 0x3C));
		} while (eax_209 != (void *) ~0x00);
		*(esp_156 - 88) = 0x00;
		*(esp_156 - 0x5C) = (HANDLE *) eax_150;
		GetFileSize(*(esp_156 - 0x5C), *(esp_156 - 88));
		*(esp_156 - 0x60) = 0x0042FCF4;
		*(esp_156 - 100) = 0x00;
		*(esp_156 - 0x68) = 0x0101;
		*(esp_156 - 0x6C) = 0x03;
		*(esp_156 - 0x70) = 0x00;
		*(esp_156 - 116) = 0x03;
		*(esp_156 - 0x78) = 0xC0000000;
		*(esp_156 - 0x7C) = 4390002;
		esp_102 = esp_156 - 0x7C;
		Eq_61 eax_235 = CreateFileW(*(esp_156 - 0x7C), *(esp_156 - 0x78), *(esp_156 - 116), *(esp_156 - 0x70), *(esp_156 - 0x6C), *(esp_156 - 0x68), *(esp_156 - 100));
	} while (eax_235 != (void *) ~0x00);
	*(esp_156 - 0x80) = (HANDLE *) eax_150;
	CloseHandle(*(esp_156 - 0x80));
	*(esp_156 - 0x84) = (HMODULE *) eax_193;
	*(esp_156 - 0x88) = (HANDLE *) eax_235;
	CloseHandle(*(esp_156 - 0x88));
	Eq_646 eax_250 = GetProcAddress(*(esp_156 - 0x88), *(esp_156 - 0x84));
	*(esp_156 - 0x8C) = 0x00;
	*(esp_156 - 0x90) = 0x05;
	*(esp_156 - 0x94) = 0x03;
	*(esp_156 - 0x98) = 0x00;
	*(esp_156 - 0x9C) = 0x02;
	*(esp_156 - 0xA0) = 0x20000000;
	*(esp_156 - 0xA4) = 4390078;
	ptr32 esp_264 = esp_156 - 0xA4;
	Eq_61 eax_266 = CreateFileW(*(esp_156 - 0xA4), *(esp_156 - 0xA0), *(esp_156 - 0x9C), *(esp_156 - 0x98), *(esp_156 - 0x94), *(esp_156 - 0x90), *(esp_156 - 0x8C));
	if (eax_266 == (void *) ~0x00)
	{
		GetLastError();
		*(esp_156 - 0xA8) = 0x00;
		*(esp_156 - 0xAC) = 0x0127;
		*(esp_156 - 0xB0) = 0x03;
		*(esp_156 - 0xB4) = 0x00;
		*(esp_156 - 0xB8) = 0x07;
		*(esp_156 - 188) = 0xE0000000;
		*(esp_156 - 0xC0) = 4390107;
		Eq_61 eax_359 = CreateFileW(*(esp_156 - 0xC0), *(esp_156 - 188), *(esp_156 - 0xB8), *(esp_156 - 0xB4), *(esp_156 - 0xB0), *(esp_156 - 0xAC), *(esp_156 - 0xA8));
		*(esp_156 - 0xC4) = 0x00;
		*(esp_156 - 200) = (HANDLE *) eax_359;
		GetFileSize(*(esp_156 - 200), *(esp_156 - 0xC4));
		*(esp_156 - 0xCC) = (HANDLE *) eax_266;
		GetFileType(*(esp_156 - 0xCC));
		*(esp_156 - 0xD0) = 0x00;
		*(esp_156 - 212) = 0x00;
		*(esp_156 - 0xD8) = 0x0121;
		*(esp_156 - 220) = 0x03;
		*(esp_156 - 0xE0) = 0x00;
		*(esp_156 - 228) = 0x06;
		*(esp_156 - 232) = 0xE0000000;
		*(esp_156 - 0xEC) = 4390034;
		ptr32 esp_385 = esp_156 - 0xEC;
		Eq_61 eax_387 = CreateFileA(*(esp_156 - 0xEC), *(esp_156 - 232), *(esp_156 - 228), *(esp_156 - 0xE0), *(esp_156 - 220), *(esp_156 - 0xD8), *(esp_156 - 212));
		if (eax_387 == (void *) ~0x00)
		{
			*(esp_156 - 0xF0) = 0x00;
			*(esp_156 - 244) = 0x00;
			*(esp_156 - 0xF8) = (HANDLE *) eax_235;
			GetFileSize(*(esp_156 - 0xF8), *(esp_156 - 244));
			esp_385 = esp_156 - 0xF8;
			dwLoc38 = eax_250();
		}
		GetCommandLineA();
		HANDLE * esp_409 = esp_385 - 0x04;
		*esp_409 = (HANDLE *) null;
		*(esp_409 - 0x04) = 0x25;
		*(esp_409 - 0x08) = 0x03;
		*(esp_409 - 0x0C) = 0x00;
		*(esp_409 - 0x10) = 0x05;
		*(esp_409 - 0x14) = 0x40000000;
		*(esp_409 - 0x18) = 4389944;
		Eq_1209 v17_403 = dwLoc38 ^ 0xC0000008;
		esp_121 = esp_409 - 0x18;
		Eq_61 eax_423 = CreateFileA(*(esp_409 - 0x18), *(esp_409 - 0x14), *(esp_409 - 0x10), *(esp_409 - 0x0C), *(esp_409 - 0x08), *(esp_409 - 0x04), *esp_409);
		do
		{
			if (eax_423 != (void *) ~0x00)
				goto l0041524D;
			ptr32 esp_439;
			word32 ebp_440;
			byte SCZO_441;
			word32 eax_442;
			byte Z_443;
			byte SZO_444;
			byte C_445;
			word32 ecx_446;
			word16 dx_447;
			word32 esi_448;
			word32 edi_449;
			(*((word32) v17_403 + 4281515))();
			*(esp_439 - 0x04) = fp - 0x24;
			*(esp_439 - 0x08) = 0x00;
			*(esp_439 - 0x0C) = 0x0186;
			*(esp_439 - 0x10) = 0x03;
			*(esp_439 - 0x14) = 0x00;
			*(esp_439 - 0x18) = 0x02;
			*(esp_439 - 0x1C) = 0xE0000000;
			*(esp_439 - 0x20) = 4390048;
			esp_121 = esp_439 - 0x20;
			eax_423 = CreateFileW(*(esp_439 - 0x20), *(esp_439 - 0x1C), *(esp_439 - 0x18), *(esp_439 - 0x14), *(esp_439 - 0x10), *(esp_439 - 0x0C), *(esp_439 - 0x08));
		} while (eax_423 != (void *) ~0x00);
		*(esp_439 - 0x24) = 0x40;
		GetLastError();
		*(esp_439 - 0x28) = 0x000141A9;
		*(esp_439 - 44) = 0x00401000;
		*(esp_439 - 0x30) = (HANDLE *) eax_387;
		GetFileType(*(esp_439 - 0x30));
		*(esp_439 - 0x34) = (HANDLE *) eax_359;
		CloseHandle(*(esp_439 - 0x34));
		VirtualProtect(*(esp_439 - 0x34), *(esp_439 - 0x30), *(esp_439 - 44), *(esp_439 - 0x28));
		esp_264 = esp_439 - 0x34;
	}
	word32 * esp_276 = esp_264 - 0x04;
	*esp_276 = 0x00401000;
	*(esp_276 - 0x04) = (union Eq_754 *) dwLoc38;
	*(esp_276 - 0x08) = 0x000141A9;
	GetCommandLineA();
	*(esp_276 - 0x0C) = 0x00;
	*(esp_276 - 0x10) = 166;
	*(esp_276 - 0x14) = 0x03;
	*(esp_276 - 0x18) = 0x00;
	*(esp_276 - 0x1C) = 0x04;
	*(esp_276 - 0x20) = 0x20000000;
	*(esp_276 - 0x24) = 0x0042FD08;
	CreateFileA(*(esp_276 - 0x24), *(esp_276 - 0x20), *(esp_276 - 0x1C), *(esp_276 - 0x18), *(esp_276 - 0x14), *(esp_276 - 0x10), *(esp_276 - 0x0C));
	GetCommandLineA();
	*(esp_276 - 0x28) = (HANDLE *) eax_209;
	CloseHandle(*(esp_276 - 0x28));
	*(esp_276 - 44) = 0x00;
	*(esp_276 - 0x30) = 0xA4;
	*(esp_276 - 0x34) = 0x03;
	*(esp_276 - 0x38) = 0x00;
	*(esp_276 - 0x3C) = 0x05;
	*(esp_276 - 0x40) = 0xC0000000;
	*(esp_276 - 0x44) = 4389977;
	Eq_61 eax_326 = CreateFileW(*(esp_276 - 0x44), *(esp_276 - 0x40), *(esp_276 - 0x3C), *(esp_276 - 0x38), *(esp_276 - 0x34), *(esp_276 - 0x30), *(esp_276 - 44));
	word32 esp_328;
	word32 ebp_329;
	byte SCZO_330;
	word32 eax_331;
	byte Z_332;
	byte SZO_333;
	byte C_334;
	byte * ecx_335;
	word16 dx_336;
	word32 esi_337;
	word32 * edi_338;
	(dwLoc38 - ~0x404155DF)();
	word32 ebp_339;
	return fn00401024(eax_331, ecx_335, dx_336, esi_337, edi_338, out ebp_339);
}

