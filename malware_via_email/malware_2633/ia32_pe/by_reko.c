// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401028: Register word32 fn00401028(Register byte al, Register word32 ecx, Register word32 edx, Register word32 ebx, Register word32 ebp, Register word32 esi, Register word32 edi, Register out ptr32 ebpOut)
word32 fn00401028(byte al, word32 ecx, word32 edx, word32 ebx, word32 ebp, word32 esi, word32 edi, ptr32 & ebpOut)
{
	word32 esp_3;
	byte P_4;
	word32 ecx_5;
	word32 * esi_6;
	byte SCZO_7;
	byte C_8;
	ui32 edx_9;
	ui32 * ebx_10;
	word16 ax_11;
	byte al_12;
	word32 ebp_13;
	byte SZO_14;
	struct Eq_24 * edi_15;
	word32 eax_16;
	fn00400FD5();
	return eax_16;
}

// 0040FDA4: Register Eq_78 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetCommandLineA();
	GetCurrentThreadId();
	GetCurrentProcessId();
	Eq_88 eax_14 = GetModuleHandleA(4411184);
	GetProcessHeap();
	GetProcessHeap();
	GetCurrentThreadId();
	GetFileType(dwLoc0C);
	GetVersion();
	Eq_109 eax_31 = GetProcAddress(dwLoc0C, eax_14);
	GetVersion();
	GetCurrentProcessId();
	GetCurrentThreadId();
	Eq_121 eax_44 = eax_31();
	GetFileSize(eax_14, null);
	<anonymous> * eax_63 = (eax_44 ^ 0xC0000005) + 4259419;
	ptr32 esp_65;
	word32 ebp_66;
	byte SCZO_67;
	word32 eax_68;
	byte SZO_69;
	byte C_70;
	byte Z_71;
	byte al_72;
	word32 ecx_73;
	word32 edx_74;
	word32 ebx_75;
	word32 esi_76;
	word32 edi_77;
	eax_63();
	GetVersion();
	*(esp_65 - 0x04) = (FARPROC *) eax_31;
	ptr32 esp_146 = esp_65 - 0x04;
	do
	{
		struct Eq_156 * esp_84 = esp_146 - 0x04;
		esp_84->t0000.u0 = 0x00;
		SizeofResource(esp_84->t0000, esp_84->t0004);
		*(esp_84 - 0x04) = (FARPROC *) eax_31;
		*(esp_84 - 0x08) = 0x00;
		SizeofResource(*(esp_84 - 0x08), *(esp_84 - 0x04));
		*(esp_84 - 0x0C) = fp - 0x24;
		GetVersion();
		*(esp_84 - 0x10) = (FARPROC *) eax_31;
		*(esp_84 - 0x14) = 0x00;
		SizeofResource(*(esp_84 - 0x14), *(esp_84 - 0x10));
		*(esp_84 - 0x18) = 0x40;
		GetCurrentThreadId();
		GetCurrentProcessId();
		*(esp_84 - 0x1C) = 60117;
		*(esp_84 - 0x20) = 0x00401000;
		*(esp_84 - 0x24) = 0x00;
		*(esp_84 - 0x28) = 0x0121;
		*(esp_84 - 44) = 0x03;
		*(esp_84 - 0x30) = 0x00;
		*(esp_84 - 0x34) = 0x06;
		*(esp_84 - 0x38) = 0xC0000000;
		*(esp_84 - 0x3C) = 4411194;
		CreateFileA(*(esp_84 - 0x3C), *(esp_84 - 0x38), *(esp_84 - 0x34), *(esp_84 - 0x30), *(esp_84 - 44), *(esp_84 - 0x28), *(esp_84 - 0x24));
		VirtualProtect(*(esp_84 - 0x3C), *(esp_84 - 0x38), *(esp_84 - 0x34), *(esp_84 - 0x30));
		GetCommandLineW();
		GetCurrentProcessId();
		*(esp_84 - 0x40) = (union Eq_121 *) eax_44;
		*(esp_84 - 0x44) = 0x00;
		*(esp_84 - 0x48) = 388;
		*(esp_84 - 0x4C) = 0x03;
		*(esp_84 - 0x50) = 0x00;
		*(esp_84 - 0x54) = 0x03;
		*(esp_84 - 88) = 0x20000000;
		*(esp_84 - 0x5C) = 4411178;
		esp_146 = esp_84 - 0x5C;
	} while (CreateFileA(*(esp_84 - 0x5C), *(esp_84 - 88), *(esp_84 - 0x54), *(esp_84 - 0x50), *(esp_84 - 0x4C), *(esp_84 - 0x48), *(esp_84 - 0x44)) != ~0x00);
	*(esp_84 - 0x60) = 60117;
	GetCurrentProcessId();
	*(esp_84 - 100) = 0x00401000;
	GetCurrentThreadId();
	word32 esp_162;
	word32 ebp_163;
	byte SCZO_164;
	word32 eax_165;
	byte SZO_166;
	byte C_167;
	byte Z_168;
	byte al_169;
	word32 ecx_170;
	word32 edx_171;
	word32 ebx_172;
	word32 esi_173;
	word32 edi_174;
	(eax_44 - ~0x4040FF75)();
	GetCurrentProcessId();
	word32 ebp_179;
	return fn00401028((byte) GetCommandLineA(), ecx_170, edx_171, ebx_172, ebp_163, esi_173, edi_174, out ebp_179);
}

