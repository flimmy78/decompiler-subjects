// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401011: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	GetCommandLineW();
	ptr32 esp_22 = fp - 0x40;
	Eq_2 eax_24 = CreateFileA(4401132, 0x60000000, 0x02, null, 0x03, 0x0121, 0x00);
	if (eax_24 == ~0x00)
	{
		GetModuleHandleA(4401132);
		GetTickCount();
		Eq_2 eax_185 = CreateFileA(4401176, 0x60000000, 0x06, null, 0x03, 0x03, 0x00);
		Eq_163 eax_187 = GetProcAddress(4401176, 0x60000000);
		Eq_2 eax_205 = CreateFileA(4401106, 0x20000000, 0x03, null, 0x03, 0x84, 0x00);
		dwLoc1C = eax_185;
		dwLoc18 = eax_205;
		if (eax_205 == ~0x00)
		{
			GetCurrentProcessId();
			CloseHandle(eax_185);
			int32 eax_229 = eax_187();
			GetCommandLineW();
			GetCurrentProcessId();
			<anonymous> * eax_246 = (eax_229 ^ 0xC0000005) + 0x00401126;
			word32 esp_248;
			word32 ebp_249;
			byte SCZO_250;
			Eq_2 eax_251;
			byte Z_252;
			byte SZO_253;
			byte C_254;
			byte cl_255;
			word32 edx_256;
			word32 ebx_257;
			byte O_258;
			word32 ecx_259;
			word32 edi_260;
			struct Eq_232 * es_261;
			byte al_262;
			eax_246();
			return eax_251;
		}
		CloseHandle(eax_185);
		GetCommandLineW();
		SizeofResource(0x00, eax_185);
		VirtualProtect(&globals->v40127F, 0x00, eax_185, (DWORD *) 55664);
		GetFileType(eax_24);
		esp_22 = fp - 0xA4;
	}
	GetCurrentProcessId();
	word32 * esp_92 = esp_22 - 0x04;
	*esp_92 = dwLoc20;
	GetCurrentThreadId();
	*(esp_92 - 0x04) = (union Eq_2 *) eax_24;
	CloseHandle(*(esp_92 - 0x04));
	*(esp_92 - 0x08) = 55664;
	*(esp_92 - 0x0C) = 0x00;
	*(esp_92 - 0x10) = (union Eq_2 *) dwLoc18;
	GetFileSize(*(esp_92 - 0x10), *(esp_92 - 0x0C));
	*(esp_92 - 0x14) = (union Eq_2 *) eax_24;
	GetFileType(*(esp_92 - 0x14));
	*(esp_92 - 0x18) = 4199039;
	*(esp_92 - 0x1C) = (union Eq_2 *) dwLoc1C;
	CloseHandle(*(esp_92 - 0x1C));
	*(esp_92 - 0x20) = (union Eq_2 *) dwLoc18;
	GetFileType(*(esp_92 - 0x20));
	word32 edx_124;
	byte cl_125 = fn00401205(dwArg00, dwArg04, dwArg08, out edx_124);
	Eq_2 eax_131 = GetCurrentThreadId();
	(eax_131 - (struct <anonymous> *) ~0x3AE414E1)->t0000 = __rcr((eax_131 - (struct <anonymous> *) ~0x3AE414E1)->b0000, cl_125, cond(eax_131 - 3306941242));
	Eq_247 v26_146 = (eax_131 - (struct <anonymous> *) 3306941146)->t0000 - ebx;
	(eax_131 - (struct <anonymous> *) 3306941146)->t0000 = v26_146;
	if (OVERFLOW(v26_146))
		;
}

// 00401205: Register byte fn00401205(Stack (ptr word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C, Register out ptr32 edxOut)
byte fn00401205(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C, ptr32 & edxOut)
{
	word32 * edx_15 = dwArg04;
	uint32 ecx_10 = dwArg08 >> 0x02;
	do
	{
		*edx_15 = *edx_15 - dwArg0C;
		*edx_15 = *edx_15 ^ 1422211808;
		*edx_15 = -*edx_15;
		*edx_15 = __ror(*edx_15, 0x60);
		*edx_15 = *edx_15 - dwArg0C;
		*edx_15 = *edx_15 ^ dwArg0C;
		ecx_10 = ecx_10 - 0x01;
		edx_15 = edx_15 + 0x01;
		*edxOut = edx_15;
		byte cl_35 = (byte) ecx_10;
	} while (ecx_10 != 0x00);
	return cl_35;
}

