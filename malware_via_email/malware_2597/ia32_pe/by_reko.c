// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00425A46: Register uint32 fn00425A46(Stack (ptr word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C, Register out (ptr (ptr Eq_201)) ebpOut)
uint32 fn00425A46(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C, Eq_201 * * & ebpOut)
{
	word32 * esi_17 = dwArg04;
	uint32 edx_20 = dwArg08 >> 0x02;
	do
	{
		*esi_17 = *esi_17 - dwArg0C;
		*esi_17 = *esi_17 + ~0x00505D15;
		*esi_17 = *esi_17 - dwArg0C;
		*esi_17 = *esi_17 + 3279938197;
		*esi_17 = *esi_17 - 2207242656;
		*esi_17 = *esi_17 ^ 3509854558;
		*esi_17 = *esi_17 ^ 1939200450;
		*esi_17 = *esi_17 ^ dwArg0C;
		*esi_17 = *esi_17 ^ dwArg0C;
		esi_17 = esi_17 + 0x01;
		edx_20 = edx_20 - 0x01;
	} while (edx_20 != 0x00);
	word32 ebp_60;
	*ebpOut = ebp;
	return edx_20;
}

// 00425AA8: Register Eq_88 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	struct Eq_201 ** ebp_102 = fp - 0x04;
	ptr32 esp_104 = fp - 0x40;
	Eq_96 eax_39 = CreateFileA(&globals->t431000, 0xC0000000, 0x03, null, 0x03, 0x0101, 0x00);
	eax_661 = eax_39;
	do
	{
		Eq_96 eax_661;
		if (eax_661 != ~0x00)
			goto l00425B59;
		LPDWORD * esp_612 = esp_104 - 0x04;
		*esp_612 = (LPDWORD *) null;
		*(esp_612 - 0x04) = (union Eq_96 *) eax_39;
		GetFileSize(*(esp_612 - 0x04), *esp_612);
		*(esp_612 - 0x08) = 0x00;
		GetACP();
		Eq_125 eax_621 = GetACP();
		ptr32 esp_622;
		byte SCZO_624;
		word32 ebx_625;
		word32 edi_626;
		word32 esi_627;
		word32 eax_628;
		byte Z_629;
		byte SZO_630;
		byte C_631;
		byte bh_632;
		byte ah_633;
		byte bl_634;
		byte al_635;
		byte CZ_636;
		byte O_640;
		byte cl_641;
		byte D_643;
		byte S_644;
		byte SCZDOP_646;
		byte FPUF_647;
		byte SO_650;
		NTDLL.DLL!ZwReplaceKey();
		*(esp_622 - 0x04) = eax_628;
		*(esp_622 - 0x08) = (union Eq_96 *) eax_39;
		*(esp_622 - 0x0C) = 0x00;
		Eq_96 eax_659 = LoadResource(*(esp_622 - 0x0C), *(esp_622 - 0x08));
		esp_104 = esp_622 - 0x0C;
		eax_661 = eax_659;
	} while (eax_659 != 0x00);
	*(esp_622 - 0x10) = (union Eq_96 *) eax_39;
	*(esp_622 - 0x14) = 0x00;
	LoadResource(*(esp_622 - 0x14), *(esp_622 - 0x10));
	*(esp_622 - 0x18) = 0x6328;
	GetOEMCP();
	*(esp_622 - 0x1C) = 4366336;
	GetCurrentThreadId();
	edx = fn00425A46(dwArg00, dwArg04, dwArg08, out ebp_102);
	GetOEMCP();
	dl = (byte) edx;
	dx = (word16) edx;
	dh = SLICE(edx, byte, 8);
	esp_104 = esp_622 - 0x10;
l00425B59:
	PDWORD * esp_117 = esp_104 - 0x04;
	*esp_117 = (PDWORD *) (ebp_102 - 0x14);
	GetOEMCP();
	*(esp_117 - 0x04) = 0x40;
	*(ebp_102 - 0x0C) = (LPSTR *) GetCommandLineA();
	*(esp_117 - 0x08) = 0x6328;
	GetCurrentProcessId();
	*(esp_117 - 0x0C) = 4366336;
	VirtualProtect(*(esp_117 - 0x0C), *(esp_117 - 0x08), *(esp_117 - 0x04), *esp_117);
	GetACP();
	Eq_182 esi_131 = *(esp_117 - 0x0C);
	struct Eq_187 * edi_133 = *(esp_117 - 0x08);
	GetACP();
	word32 ebx_136 = *(esp_117 - 0x04);
	struct Eq_201 * ebp_139 = *ebp_102;
	struct Eq_205 * esp_140 = (char *) ebp_102 + 0x04;
	*(esp_140 - 0x04) = 0x00;
	*(esp_140 - 0x08) = *(ebp_139 - 0x04);
	GetFileSize(*(esp_140 - 0x08), *(esp_140 - 0x04));
	*(esp_140 - 0x0C) = 0x00;
	*(esp_140 - 0x10) = *(ebp_139 - 0x04);
	Eq_88 eax_152 = GetFileSize(*(esp_140 - 0x10), *(esp_140 - 0x0C));
	byte bl_137 = (byte) ebx_136;
	byte ah_154 = SLICE(eax_152, byte, 8);
	byte bh_156 = edi_133->b004D;
	*(esp_140 - (struct Eq_421 *) 0x14) = (struct Eq_187 **) edi_133;
	ci8 ah_162 = ah_154 + bl_137 + bl_137;
	ui32 ebx_157 = DPB(ebx_136, bh_156, 8);
	Eq_431 esp_159 = esp_140 - (struct Eq_421 *) 0x14;
	byte al_161 = (byte *) 0x4D7FE300;
	Eq_88 eax_163 = DPB(eax_152, ah_162, 8);
	if (ah_162 <= 0x00)
	{
		int32 ebx_236 = ebx_157 & esp_140 - (struct Eq_421 *) 0x14;
		byte bh_237 = SLICE(ebx_236, byte, 8);
		ci8 bl_238 = (byte) ebx_236;
		if (ebx_236 > 0x00)
			;
		if (true)
		{
			bool C_268;
			Eq_451 al_260;
			if (ebx_236 <= 0x00)
			{
				if (false)
					return eax_163;
				(esp_140 - (struct Eq_485 *) 22)->w0000 = (word16) cs;
				al_260.u0 = 0x6A;
				C_268 = cond(DPB(eax_163, 0x6A, 0) - (esi_131 + 0x01));
l0042A049:
				edi_133->t0000 = al_260;
				__outb(0x5C, al_260);
				if (C_268)
					;
				else
					__cli();
			}
			Eq_454 SCZDOP_378;
			byte Z_327;
			struct Eq_187 * edi_296 = edi_133 - 0x01;
			DWORD eax_298 = DPB(eax_163, al_161 | 161, 0);
			Eq_454 S_303 = cond(al_161 | 161);
			byte ah_306;
			byte al_305;
			Eq_454 C_307 = __aas(al_161 | 161, ah_162, &al_305, &ah_306);
			if (OVERFLOW(al_161 | 161))
			{
				eax_298 = (Eq_459) ((word32) C_307 + ((word32) eax_298 + *(edi_133 - 0x3F)));
				Eq_454 SCZO_569 = cond(eax_298);
				ecx = ecx - 0x01;
				ah_306 = SLICE(eax_298, byte, 8);
				al_305 = (byte) eax_298;
				C_307 = SCZO_569;
				S_303 = SCZO_569;
				SCZDOP_378 = SCZO_569;
				*(esp_140 - 22) = ss;
				esp_159 = esp_140 - 22;
				if (eax_298 != 0x00)
					goto l0042A0C0;
			}
			esp_159 = esp_159 - 0x02;
			*esp_159 = ss;
			if (S_303)
				;
			bl_238 = (ci8) ((word32) C_307 + (bl_238 + ah_306));
			Z_327 = cond(bl_238);
			if (bl_238 > 0x00)
				goto l0042A0FB;
			Eq_591 eax_532 = DPB(eax_298, al_305 | ~0x58, 0);
			eax_532->dw0065 = eax_532->dw0065 - ebp_139;
			struct Eq_602 * ebp_537 = ebp_139->ptr0000;
			ah_306 = ebp_537->b0078;
			Mem542[ebp_139 + 0x02:word16] = ds;
			__wait();
			esp_159 = ebp_139 + 0x02;
			esi_131 = esi_131 - 0x01;
			ecx = ecx + 0x01;
			ebp_139 = (struct Eq_201 *) ((char *) ebp_537 + 0x01);
l0042A0BE:
			dl = dl + bh_237;
			Eq_454 SCZO_492 = cond(dl);
			edx = DPB(edx, dl, 0);
			dx = DPB(dx, dl, 0);
			C_307 = SCZO_492;
			SCZDOP_378 = SCZO_492;
l0042A0C0:
			union Eq_454 * esp_381 = esp_159 - 0x04;
			*esp_381 = (union Eq_454 *) SCZDOP_378;
			edi_296->t0000.u0 = esi_131->b0000;
			Eq_635 esi_385 = esi_131 - (struct <anonymous> *) 0x01;
			al_260.u0 = esi_385->b0000;
			*(esp_381 - 0x02) = (union Eq_484 *) ss;
			edi_133 = edi_296 - 0x01 - ebp_139 - C_307;
			esi_131 = esi_385 - (struct <anonymous> *) 0x01;
			byte SCZO_394 = cond(edi_133);
			if (edi_133 != null)
			{
				ci8 ah_449 = ah_306 + bl_238;
				C_268 = cond(ah_449);
				if (ah_449 <= 0x00)
				{
					word32 eax_461 = (word32 *) 0xAB8D2B68;
					__outb(0x3F, (byte) eax_461);
					edi_133->t0000 = __in(dx);
					(word32 *) 3757975243 = eax_461;
					return eax_461;
				}
				goto l0042A049;
			}
			*(esp_381 - 0x06) = (DWORD *) (esi_385 - (struct <anonymous> *) 0x01);
			*ecx = __rcr(*ecx, 0x5C, SCZO_394);
			*(esp_381 - 0x0A) = esp_381 - 0x06;
			*(esp_381 - 0x0E) = 0x53;
			word32 eax_419 = __indw(dx);
			Eq_451 al_420 = (byte) eax_419;
			(union Eq_451 *) 0x6A0A01FA = (union Eq_451 *) al_420;
			__sti();
			edi_133->t0000 = al_420;
			int3();
			esp_159 = esp_381 - 0x0E;
			ah_306 = 0x49;
			struct Eq_712 * eax_423 = DPB(eax_419, 0x49, 8);
			edi_296 = edi_133;
			do
			{
				word32 ebx_436 = eax_423->dw2DBCE215;
				__cli();
				bh_237 = SLICE(ebx_436, byte, 8);
				bl_238 = (byte) ebx_436;
				ebp_139 = edx;
				Z_327 = cond(al_420 & 0x4E);
			} while ((al_420 & 0x4E) >= 0x00);
l0042A0FB:
			ecx = ecx - 0x01;
			if (!Z_327 || ecx == null)
			{
				*(ecx - 113) = *(ecx - 113) >> 0x01;
				null[edx].b0000 = dh;
			}
			goto l0042A0BE;
		}
	}
	else
	{
		*(edi_133 - 66) = ebx_157;
		(esp_140 - 0x18)->w0000 = (word16) (esp_140 - (struct Eq_421 *) 0x14);
		struct Eq_511 * ecx_607 = DPB(ecx, 0x45, 0);
		Mem609[esp_140 - 0x18 + ecx_607:word32] = Mem605[esp_140 - 0x18 + ecx_607:word32] - ecx_607;
	}
	word32 esp_206;
	word32 ebp_207;
	byte SCZO_208;
	word32 ebx_209;
	word32 edi_210;
	word32 esi_211;
	word32 eax_212;
	byte Z_213;
	byte SZO_214;
	byte C_215;
	byte bh_216;
	byte ah_217;
	byte bl_218;
	byte al_219;
	byte CZ_220;
	struct Eq_564 * cs_221;
	word32 ecx_222;
	byte dl_223;
	byte O_224;
	byte cl_225;
	struct Eq_569 * ss_226;
	byte D_227;
	byte S_228;
	struct Eq_572 * ds_229;
	byte SCZDOP_230;
	byte FPUF_231;
	word32 edx_232;
	word16 dx_233;
	byte SO_234;
	byte dh_235;
	fn00429FD7();
	return eax_212;
}

