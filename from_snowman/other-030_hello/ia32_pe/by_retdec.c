//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2018 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>
#include <windows.h>

// ------------------------ Structures ------------------------

struct _LIST_ENTRY {
    struct _LIST_ENTRY * e0;
    struct _LIST_ENTRY * e1;
};

struct _RTL_CRITICAL_SECTION {
    struct _RTL_CRITICAL_SECTION_DEBUG * e0;
    int32_t e1;
    int32_t e2;
    char * e3;
    char * e4;
    int32_t e5;
};

struct _RTL_CRITICAL_SECTION_DEBUG {
    int16_t e0;
    int16_t e1;
    struct _RTL_CRITICAL_SECTION * e2;
    struct _LIST_ENTRY e3;
    int32_t e4;
    int32_t e5;
    int32_t e6;
    int16_t e7;
    int16_t e8;
};

// ------------------- Function Prototypes --------------------

int32_t ___CTOR_LIST__(int32_t a1, int32_t a2);
char * ___gcc_deregister_frame(int32_t a1, int32_t a2);
char * ___gcc_register_frame(void);
int32_t ___register_frame_info(void);
int32_t ___w64_mingwthr_remove_key_dtor(int32_t key);
void __do_global_ctors(void);
void __do_global_dtors(void);
void __main(void);
int32_t _register_frame_ctor(void);
int32_t function_401489(int32_t a1);
int32_t function_401925(int32_t a1);
int32_t function_401a05(int32_t a1);

// --------------------- Global Variables ---------------------

int32_t __mingwthr_cs = 0;
int32_t __mingwthr_cs_init = 0;
bool g1 = false; // cf
int32_t g2 = 0; // eax
int32_t g3 = 0; // ebp
int32_t g4 = 0; // ebx
int32_t g5 = 0; // ecx
int32_t g6 = 0; // edx
int32_t g7 = 0; // esp
int32_t g8 = -1; // 0x401c60
int32_t g9 = 0x401c74; // 0x402008
int32_t g10 = 0; // 0x40200c
int32_t g11 = 20; // 0x404000
int32_t g12 = 0; // 0x405008
int32_t initialized = 0;
int32_t key_dtor_list = 0;

// ------------------------ Functions -------------------------

// Address range: 0x4012bc - 0x401347
char * ___gcc_register_frame(void) {
    int32_t v1;
    g3 = &v1;
    char * moduleHandle = GetModuleHandleA("libgcc_s_dw2-1.dll"); // 0x4012c9
    char * moduleHandle2; // 0x40130c
    int32_t (**func)(); // 0x401321
    int32_t v2; // 0x4012fb
    if (moduleHandle == NULL) {
        // 0x4012e6
        g2 = 0x401b84;
        g1 = false;
        // branch -> 0x4012ea
        // 0x4012ea
        ((int32_t (*)(int32_t, int32_t))0x401b84)((int32_t)&g11, (int32_t)&g12);
        // branch -> 0x4012fb
        // 0x4012fb
        v2 = g10;
        g5 = v2;
        if (v2 == 0) {
            // 0x401336
            return (char *)g2;
        }
        // 0x401305
        moduleHandle2 = GetModuleHandleA("libgcj-13.dll");
        if (moduleHandle2 == NULL) {
            // 0x401329
            g2 = 0;
            // branch -> 0x401336
            // 0x401336
            return (char *)g2;
        }
        // 0x401329
        func = GetProcAddress(moduleHandle2, "_Jv_RegisterClasses");
        g2 = (int32_t)func;
        g1 = false;
        if (func != NULL) {
            // 0x40132d
            ((int32_t (*)(int32_t))func)((int32_t)&g10);
            // branch -> 0x401336
        }
        // 0x401336
        return (char *)g2;
    }
    int32_t (**func2)() = GetProcAddress(moduleHandle, "__register_frame_info"); // 0x4012de
    int32_t v3 = (int32_t)func2; // 0x4012de_5
    g2 = v3;
    g1 = false;
    if (func2 != NULL) {
        // 0x4012ea
        ((int32_t (*)(int32_t, int32_t))v3)((int32_t)&g11, (int32_t)&g12);
        // branch -> 0x4012fb
    }
    // 0x4012fb
    v2 = g10;
    g5 = v2;
    if (v2 == 0) {
        // 0x401336
        return (char *)g2;
    }
    // 0x401305
    moduleHandle2 = GetModuleHandleA("libgcj-13.dll");
    if (moduleHandle2 == NULL) {
        // 0x401329
        g2 = 0;
        // branch -> 0x401336
    } else {
        // 0x401329
        func = GetProcAddress(moduleHandle2, "_Jv_RegisterClasses");
        g2 = (int32_t)func;
        g1 = false;
        if (func != NULL) {
            // 0x40132d
            ((int32_t (*)(int32_t))func)((int32_t)&g10);
            // branch -> 0x401336
        }
    }
    // 0x401336
    return (char *)g2;
}

// Address range: 0x401348 - 0x40138b
char * ___gcc_deregister_frame(int32_t a1, int32_t a2) {
    int32_t v1;
    g3 = &v1;
    char * moduleHandle = GetModuleHandleA("libgcc_s_dw2-1.dll"); // 0x401355
    if (moduleHandle == NULL) {
        // 0x401372
        g2 = 0x401b7c;
        g1 = false;
        // branch -> 0x401376
        // 0x401376
        ((int32_t (*)(int32_t))0x401b7c)((int32_t)&g11);
        // branch -> 0x40137f
        // 0x40137f
        return (char *)g2;
    }
    int32_t (**func)() = GetProcAddress(moduleHandle, "__deregister_frame_info"); // 0x40136a
    int32_t v2 = (int32_t)func; // 0x40136a_5
    g2 = v2;
    g1 = false;
    char * result; // 0x401380_2
    if (func != NULL) {
        // 0x401376
        ((int32_t (*)(int32_t))v2)((int32_t)&g11);
        result = (char *)g2;
        // branch -> 0x40137f
    } else {
        result = NULL;
    }
    // 0x40137f
    return result;
}

// From module:   C:\yegor\tmp/test.cpp
// Address range: 0x40138c - 0x4013a9
// Line range:    3 - 5
int main(int argc, char ** argv) {
    // 0x40138c
    __main();
    return g2;
}

// Address range: 0x401489 - 0x40148b
int32_t function_401489(int32_t a1) {
    // 0x401489
    return 0;
}

// From module:   ../mingw/gccmain.c
// Address range: 0x4018f8 - 0x401924
// Line range:    22 - 35
void __do_global_dtors(void) {
    int32_t v1;
    g3 = &v1;
    int32_t v2 = *(int32_t *)g9; // 0x401903
    g2 = v2;
    if (v2 == 0) {
        // 0x401923
        return;
    }
    g1 = false;
    ((int32_t (*)())v2)();
    int32_t v3 = g9 + 4; // 0x401913
    g6 = v3;
    g9 = v3;
    int32_t v4 = *(int32_t *)v3; // 0x40191c
    g2 = v4;
    while (v4 != 0) {
        // 0x40190c
        g1 = false;
        ((int32_t (*)())v4)();
        v3 = g9 + 4;
        g6 = v3;
        g9 = v3;
        v4 = *(int32_t *)v3;
        g2 = v4;
        // continue -> 0x40190c
    }
    // 0x401923
    // branch -> 0x401923
}

// Address range: 0x401925 - 0x401927
int32_t function_401925(int32_t a1) {
    // 0x401925
    return 0;
}

// From module:   ../mingw/gccmain.c
// Address range: 0x401928 - 0x401973
// Line range:    38 - 50
void __do_global_ctors(void) {
    int32_t v1;
    g3 = &v1;
    if (*(int32_t *)((int32_t)&g8 + 4) == 0) {
        // 0x401970
        // branch -> 0x40194a
        // 0x40194a
        g2 = atexit((void (**)())__do_global_dtors);
        return;
    }
    int32_t v2 = 1; // 0x401960
    g4 = v2;
    int32_t v3 = v2 + 1; // 0x401962
    g2 = v3;
    int32_t v4 = *(int32_t *)(4 * v3 + (int32_t)&g8); // 0x401965
    while (v4 != 0) {
        // 0x401960
        g6 = v4;
        v2 = v3;
        g4 = v2;
        v3 = v2 + 1;
        g2 = v3;
        v4 = *(int32_t *)(4 * v3 + (int32_t)&g8);
        // continue -> 0x401960
    }
    // 0x401970
    g1 = false;
    if (v2 == 0) {
        // 0x40194a
        g2 = atexit((void (**)())__do_global_dtors);
        return;
    }
    ((int32_t (*)())*(int32_t *)(4 * v2 + (int32_t)&g8))();
    int32_t v5 = g4 - 1; // 0x401947
    g4 = v5;
    while (v5 != 0) {
        // 0x401940
        ((int32_t (*)())*(int32_t *)(4 * v5 + (int32_t)&g8))();
        v5 = g4 - 1;
        g4 = v5;
        // continue -> 0x401940
    }
    // 0x40194a
    g2 = atexit((void (**)())__do_global_dtors);
}

// From module:   ../mingw/gccmain.c
// Address range: 0x401974 - 0x401997
// Line range:    71 - 76
void __main(void) {
    int32_t v1 = initialized; // 0x40197a
    g5 = v1;
    if (v1 != 0) {
        // 0x401984
        return;
    }
    // 0x401988
    initialized = 1;
    __do_global_ctors();
}

// Address range: 0x401a05 - 0x401a07
int32_t function_401a05(int32_t a1) {
    // 0x401a05
    return 0;
}

// From module:   ../mingw/tlsthrd.c
// Address range: 0x401a78 - 0x401b03
// Line range:    64 - 82
int32_t ___w64_mingwthr_remove_key_dtor(int32_t key) {
    if (__mingwthr_cs_init == 0) {
        // 0x401a8b
        g2 = 0;
        return 0;
    }
    // 0x401a94
    EnterCriticalSection((struct _RTL_CRITICAL_SECTION *)&__mingwthr_cs);
    int32_t v1 = key_dtor_list; // 0x401aa1
    if (v1 == 0) {
        // 0x401ac3
        LeaveCriticalSection((struct _RTL_CRITICAL_SECTION *)&__mingwthr_cs);
        // branch -> 0x401ad0
        // 0x401ad0
        g2 = 0;
        return 0;
    }
    int32_t v2 = *(int32_t *)(v1 + 8); // 0x401af5
    if (*(int32_t *)v1 == key) {
        // 0x401af5
        key_dtor_list = v2;
        // branch -> 0x401ade
        // 0x401ade
        free((char *)v1);
        LeaveCriticalSection((struct _RTL_CRITICAL_SECTION *)&__mingwthr_cs);
        // branch -> 0x401ad0
        // 0x401ad0
        g2 = 0;
        return 0;
    }
    int32_t v3 = v2; // eax
    if (v2 == 0) {
        // 0x401ac3
        LeaveCriticalSection((struct _RTL_CRITICAL_SECTION *)&__mingwthr_cs);
        // branch -> 0x401ad0
    } else {
        while (true) {
            // 0x401ab4
            if (*(int32_t *)v2 == key) {
                // 0x401ad8
                *(int32_t *)(v1 + 8) = *(int32_t *)(v2 + 8);
                // branch -> 0x401ade
                // 0x401ade
                free((char *)v3);
                LeaveCriticalSection((struct _RTL_CRITICAL_SECTION *)&__mingwthr_cs);
                // branch -> 0x401ad0
                // 0x401ad0
                g2 = 0;
                return 0;
            }
            int32_t v4 = *(int32_t *)(v2 + 8); // 0x401abc
            v3 = v4;
            if (v4 == 0) {
                // break -> 0x401abc
                break;
            }
            v1 = v2;
            v2 = v4;
            // continue -> 0x401ab4
        }
        // 0x401abc
        // branch -> 0x401ac3
        // 0x401ac3
        LeaveCriticalSection((struct _RTL_CRITICAL_SECTION *)&__mingwthr_cs);
        // branch -> 0x401ad0
    }
    // 0x401ad0
    g2 = 0;
    return 0;
}

// Address range: 0x401b84 - 0x401b8b
int32_t ___register_frame_info(void) {
    // 0x401b84
    __register_frame_info();
    return g2;
}

// Address range: 0x401c44 - 0x401c5f
int32_t _register_frame_ctor(void) {
    // 0x401c44
    ___gcc_register_frame();
    return atexit((void (**)())___gcc_deregister_frame);
}

// Address range: 0x401c60 - 0x401c6e
int32_t ___CTOR_LIST__(int32_t a1, int32_t a2) {
    // 0x401c60
    ((int32_t (*)(int32_t, int32_t))*(int32_t *)g4)(a1, a2);
    uint32_t v1 = g2 + 64 + (int32_t)g1; // 0x401c65
    int32_t result = v1 % 256 | g2 & -256; // 0x401c65
    char * v2 = (char *)result;
    g2 = result;
    char * v3 = (char *)(g7 + 64 + g4); // 0x401c67_0
    *v3 = (char)((int32_t)*v3 + v1);
    int32_t v4 = (int32_t)*v2 + v1; // 0x401c6b
    unsigned char v5 = (char)v4; // 0x401c6b
    g1 = v5 + (char)v1 < v5;
    *v2 = (char)(v4 + v1);
    return result;
}

// --------------- Dynamically Linked Functions ---------------

// void __register_frame_info(void);
// int atexit(void(* func)(void));
// VOID EnterCriticalSection(_Inout_ LPCRITICAL_SECTION lpCriticalSection);
// void free(void * ptr);
// HMODULE GetModuleHandleA(_In_opt_ LPCSTR lpModuleName);
// FARPROC GetProcAddress(_In_ HMODULE hModule, _In_ LPCSTR lpProcName);
// VOID LeaveCriticalSection(_Inout_ LPCRITICAL_SECTION lpCriticalSection);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (4.5.2)
// Detected language: C, C++
// Detected functions: 13
// Decompiler release: VERSION
// Decompilation date: DATE
