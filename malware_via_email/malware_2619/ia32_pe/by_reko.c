// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00427BD1: Register word32 fn00427BD1(Stack (ptr word32) dwArg04, Stack uint32 dwArg08, Stack word32 dwArg0C)
word32 fn00427BD1(word32 * dwArg04, uint32 dwArg08, word32 dwArg0C)
{
	word32 * ecx_17 = dwArg04;
	uint32 edi_20 = dwArg08 >> 0x02;
	do
	{
		*ecx_17 = *ecx_17 - dwArg0C;
		*ecx_17 = *ecx_17 ^ dwArg0C;
		*ecx_17 = *ecx_17 ^ 2131788971;
		*ecx_17 = __ror(*ecx_17, 0x93);
		*ecx_17 = *ecx_17 - dwArg0C;
		ecx_17 = ecx_17 + 0x01;
		edi_20 = edi_20 - 0x01;
	} while (edi_20 != 0x00);
	return ebp;
}

// 00427C37: Register Eq_57 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	ptr32 ebp_23 = fp - 0x04;
	ptr32 esp_14 = fp + ~0x27;
l00427C40:
	word32 * esp_27 = esp_14 - 0x04;
	*esp_27 = 0x00;
	*(ebp_23 - 0x18) = (LPSTR *) GetCommandLineA();
	*(esp_27 - 0x04) = 0x00;
	*(esp_27 - 0x08) = 0x00;
	GetCommandLineW();
	*(esp_27 - 0x0C) = 4411427;
	*(esp_27 - 0x10) = 0x00;
	*(esp_27 - 0x14) = 0x01A5;
	ptr32 esp_129 = esp_27 - 0x14;
	do
	{
		struct Eq_366 * esp_48 = esp_129 - 0x04;
		esp_48->t0000 = 0x03;
		*(esp_48 - 0x04) = 0x00;
		*(esp_48 - 0x08) = 0x06;
		*(esp_48 - 0x0C) = 0xE0000000;
		*(esp_48 - 0x10) = 4411437;
		Eq_91 eax_58 = CreateFileA(*(esp_48 - 0x10), *(esp_48 - 0x0C), *(esp_48 - 0x08), *(esp_48 - 0x04), esp_48->t0000, esp_48->t0004, esp_48->t0008);
		*(ebp_23 - 0x10) = (HANDLE *) eax_58;
		ptr32 esp_191 = esp_48 - 0x10;
		if (eax_58 == (void *) ~0x00)
		{
			*(esp_48 - 0x14) = *(ebp_23 - 0x10);
			GetFileType(*(esp_48 - 0x14));
			Eq_125 eax_155 = LoadLibraryA(*(esp_48 - 0x14));
			*(esp_48 - 0x18) = 4411399;
			*(esp_48 - 0x1C) = (HMODULE *) eax_155;
			*(esp_48 - 0x20) = GetProcAddress(*(esp_48 - 0x1C), *(esp_48 - 0x18))();
			*(esp_48 - 0x24) = 0x00;
			*(esp_48 - 0x28) = 0x0125;
			*(esp_48 - 44) = 0x03;
			*(esp_48 - 0x30) = 0x00;
			*(esp_48 - 0x34) = 0x04;
			*(esp_48 - 0x38) = 0x60000000;
			*(esp_48 - 0x3C) = 0x00435000;
			Eq_91 eax_186 = CreateFileA(*(esp_48 - 0x3C), *(esp_48 - 0x38), *(esp_48 - 0x34), *(esp_48 - 0x30), *(esp_48 - 44), *(esp_48 - 0x28), *(esp_48 - 0x24));
			*(ebp_162 - 0x0C) = (HANDLE *) eax_186;
			esp_14 = esp_48 - 0x3C;
			dx = dx_169;
			ebp_23 = ebp_162;
			if (eax_186 != (void *) ~0x00)
				goto l00427C40;
			GetOEMCP();
			*(esp_48 - 0x40) = 0x76DB;
			esp_191 = esp_48 - 0x40;
			dx = dx_169;
			ebp_23 = ebp_162;
		}
		HRSRC * esp_67 = esp_191 - 0x04;
		*esp_67 = (HRSRC *) &globals->t42D000;
		*(esp_67 - 0x04) = 0x00;
		*(esp_67 - 0x08) = *(ebp_23 - 0x10);
		GetFileSize(*(esp_67 - 0x08), *(esp_67 - 0x04));
		ebp_23 = fn00427BD1(dwArg00, dwArg04, dwArg08);
		*esp_67 = *(ebp_23 - 0x10);
		*(esp_67 - 0x04) = 0x00;
		SizeofResource(*(esp_67 - 0x04), *esp_67);
		*(esp_67 - 0x08) = *(ebp_23 - 0x0C);
		GetFileType(*(esp_67 - 0x08));
		*(esp_67 - 0x0C) = ebp_23 - 0x04;
		*(esp_67 - 0x10) = 0x40;
		GetOEMCP();
		*(esp_67 - 0x14) = 0x76DB;
		*(esp_67 - 0x18) = *(ebp_23 - 0x10);
		CloseHandle(*(esp_67 - 0x18));
		*(esp_67 - 0x1C) = *(ebp_23 - 0x0C);
		CloseHandle(*(esp_67 - 0x1C));
		*(esp_67 - 0x20) = 0x0042D000;
		*(esp_67 - 0x24) = *(ebp_23 - 0x10);
		GetFileType(*(esp_67 - 0x24));
		VirtualProtect(*(esp_67 - 0x24), *(esp_67 - 0x20), *(esp_67 - 0x1C), *(esp_67 - 0x18));
		*(ebp_23 - 0x08) = (LPSTR *) GetCommandLineA();
		*(esp_67 - 0x24) = 0x00;
		*(esp_67 - 0x28) = 0x0121;
		*(esp_67 - 44) = 0x03;
		*(esp_67 - 0x30) = 0x00;
		*(esp_67 - 0x34) = 0x07;
		*(esp_67 - 0x38) = 0x20000000;
		*(esp_67 - 0x3C) = 4411412;
		Eq_91 eax_131 = CreateFileA(*(esp_67 - 0x3C), *(esp_67 - 0x38), *(esp_67 - 0x34), *(esp_67 - 0x30), *(esp_67 - 44), *(esp_67 - 0x28), *(esp_67 - 0x24));
		*(ebp_23 - 0x14) = (HANDLE *) eax_131;
		esp_129 = esp_67 - 0x3C;
	} while (eax_131 != (void *) ~0x00);
	*(esp_67 - 0x3C) = *(ebp_23 - 0x14);
	CloseHandle(*(esp_67 - 0x3C));
	DWORD eax_145 = GetCurrentProcessId();
	*eax_145 = (Eq_57) 0x2B;
	__outdw(dx, eax_145);
}

