// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 004160C6: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	word32 ecx_10 = ~0x0001869F;
	do
		ecx_10 = ecx_10 - 0x01;
	while (ecx_10 != 0x00);
	ptr32 ebx_46 = globals->ptr4161D0;
	word32 * esi_47 = ebx_46 + 77286;
	while (true)
	{
		word32 eax_57 = *esi_47;
		word16 ax_58 = (word16) eax_57;
		int32 * esi_59 = esi_47 + 0x01;
		if (eax_57 == 0x00)
			break;
		*(fp - 0x24) = eax_57;
		word32 eax_66 = DPB(eax_57, ax_58, 0);
		ptr32 edi_75 = ebx_46 + *esi_59;
		*(fp - 0x28) = esi_59 + 0x01;
		*(fp - 44) = edi_75;
		fn00416290(eax_66, esi_59 + 0x01, esi_59 + 0x01);
		byte * esi_84 = *(fp - 0x28);
		fn00416186(0x004161B8, esi_84, Mem79[fp - 44 + 0x00:word32]);
		word32 eax_86 = *(fp - 0x24);
		esi_47 = (word32 *) (esi_84 + eax_86);
	}
	struct Eq_17 * esp_98;
	word32 ecx_99;
	byte SZO_100;
	byte C_101;
	word32 edx_102;
	byte SCZO_103;
	word16 dx_104;
	word32 eax_105;
	word32 ebx_106;
	word32 ebp_107;
	word32 esi_108;
	word32 edi_109;
	word16 ax_110;
	word16 cx_111;
	byte D_112;
	byte Z_113;
	bcuiposr0 None_114;
	(ebx_46 + 52712)();
	Eq_2 eax_128 = esp_98->t001C;
	esp_98->t001C = 0x00401272;
	return eax_128;
}

// 00416186: void fn00416186(Register Eq_88 ebp, Register (ptr byte) esi, Register (ptr byte) edi)
void fn00416186(Eq_88 ebp, byte * esi, byte * edi)
{
	struct Eq_112 * esp_110 = fp - 0x20;
	bui8 dl_112 = 0x80;
	word32 ebx_125 = 0x00;
	while (true)
	{
		*edi = *esi;
		byte * esi_109 = esi + 0x01;
		edi = edi + 0x01;
		ebx_125 = DPB(ebx_125, 0x02, 0);
		while (!fn00416200(dl_112, esi_109, out dl_112, out esi))
		{
			Eq_88 eax_121;
			Eq_134 ecx_102;
			Eq_88 eax_129;
			bui8 dl_79;
			byte * esi_80;
			if (fn00416200(dl_112, esi, out dl_79, out esi_80))
			{
				bui8 dl_226;
				byte * esi_227;
				uint32 ecx_229 = fn0041620C(0x00, dl_79, esi_80, out dl_226, out esi_227) - ebx_125;
				if (ecx_229 == 0x00)
				{
					ecx_102 = fn0041620A(dl_226, esi_227, out dl_112, out esi_109);
					esp_110 = (struct Eq_112 *) ((char *) esp_110 - 0x04);
					goto l004161F2;
				}
				eax_129 = DPB(ecx_229 - 0x01 << 0x08, *esi_227, 0);
				ecx_102 = fn0041620A(dl_226, esi_227 + 0x01, out dl_112, out esi_109);
				esp_110 = (struct Eq_112 *) ((char *) esp_110 - 0x04);
				if (eax_129 < 0x7D00)
				{
					if (ecx_229 >= 0x06)
						goto l004161F0;
					if (eax_129 <= 0x7F)
						goto l004161EF;
				}
				else
				{
l004161EF:
					ecx_102.u1 = (word32) ecx_102.u1 + 0x01;
l004161F0:
					ecx_102.u1 = (word32) ecx_102.u1 + 0x01;
				}
				ebp = eax_129;
l004161F2:
				eax_121 = ebp;
				ebx_125 = DPB(ebx_125, 0x01, 0);
l004161F6:
				byte ** esp_96 = esp_110 - 0x04;
				*esp_96 = (byte **) esi_109;
				byte * esi_101 = edi - eax_121;
				while (ecx_102 != 0x00)
				{
					*edi = *esi_101;
					esi_101 = esi_101 + 0x01;
					edi = edi + 0x01;
					ecx_102 = ecx_102 - 0x01;
				}
				esi_109 = (byte *) *esp_96;
				esp_110 = (struct Eq_112 *) ((char *) esp_96 + 0x04);
				continue;
			}
			if (fn00416200(dl_79, esi_80, out dl_112, out esi_109))
			{
				uint32 eax_196 = (word32) *esi_109;
				esi_109 = esi_109 + 0x01;
				eax_129 = eax_196 >> 0x01;
				if (eax_196 >> 0x01 == 0x00)
				{
					esp_110[0x07] = (struct Eq_112) (edi - esp_110[0x0A]);
					return;
				}
				ecx_102 = eax_196 >> 0x01 < 0x00;
				goto l004161EF;
			}
			ebx_125 = DPB(ebx_125, 0x02, 0);
			ecx_102.u1 = 0x01;
			uint8 al_177 = 0x10;
			eax_121.u0 = 0x10;
			do
			{
				al_177 = al_177 * 0x02 + fn00416200(dl_112, esi_109, out dl_112, out esi_109);
				eax_121 = DPB(eax_121, al_177, 0);
			} while (al_177 >= 0x00);
			if (al_177 != 0x00)
				goto l004161F6;
			*edi = al_177;
			edi = edi + 0x01;
		}
	}
}

// 00416200: FlagGroup byte fn00416200(Register bui8 dl, Register (ptr byte) esi, Register out Eq_142 dlOut, Register out (ptr byte) esiOut)
byte fn00416200(bui8 dl, byte * esi, Eq_142 & dlOut, byte * & esiOut)
{
	*esiOut = esi;
	byte dl_3;
	*dlOut = dl * 0x02;
	byte C_14 = cond(dl * 0x02);
	if (dl * 0x02 == 0x00)
	{
		bool dl_20 = (byte) (*esi * 0x02) + (dl * 0x02 < 0x00);
		*dlOut = dl_20;
		word32 esi_19;
		*esiOut = esi + 0x01;
		C_14 = cond(dl_20);
	}
	return C_14;
}

// 0041620A: Register word32 fn0041620A(Register bui8 dl, Register (ptr byte) esi, Register out Eq_258 dlOut, Register out (ptr byte) esiOut)
word32 fn0041620A(bui8 dl, byte * esi, Eq_258 & dlOut, byte * & esiOut)
{
	byte dl_7;
	word32 esi_8;
	return fn0041620C(0x00, dl, esi, out dl_7, out esi_8);
}

// 0041620C: Register Eq_152 fn0041620C(Register Eq_152 ecx, Register bui8 dl, Register (ptr byte) esi, Register out Eq_155 dlOut, Register out ptr32 esiOut)
Eq_152 fn0041620C(Eq_152 ecx, bui8 dl, byte * esi, Eq_155 & dlOut, ptr32 & esiOut)
{
	Eq_152 ecx_13 = (word32) ecx + 0x01;
	do
	{
		bui8 dl_10;
		byte * esi_11;
		ecx_13 = (word32) (ecx_13 * 0x02) + fn00416200(dl, esi, out dl_10, out esi_11);
	} while (fn00416200(dl_10, esi_11, out dl, out esi));
	return ecx_13;
}

// 00416290: void fn00416290(Register word32 ecx, Register (ptr byte) esi, Register (ptr byte) edi)
void fn00416290(word32 ecx, byte * esi, byte * edi)
{
	do
	{
		byte al_21 = *esi;
		byte * esi_23 = esi + 0x01;
		ui8 al_28 = al_21 ^ 0x6C ^ 0xA8;
		ui8 al_42 = al_28 ^ 0x4B ^ 0xE0 ^ 0x06 ^ 0x11;
		esi = esi_23;
		ui8 al_54 = al_42 ^ 0x23 ^ ~0x28;
		ui8 al_69 = al_54 ^ 0xA0 ^ 0x9A ^ 0x07 ^ ~0x41 ^ 0x2E ^ 0x5D;
		ui8 al_76 = al_69 ^ 0x7D ^ 0x5F;
		ui8 al_84 = al_76 ^ 66 ^ 222;
		*edi = al_84 ^ ~0x50;
		edi = edi + 0x01;
		ecx = ecx - 0x01;
	} while (ecx != 0x00);
}

