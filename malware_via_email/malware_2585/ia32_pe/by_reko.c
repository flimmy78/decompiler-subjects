// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401023: Register word32 fn00401023(Register word32 eax, Register word32 ecx, Register word32 ebx, Register word32 edi)
word32 fn00401023(word32 eax, word32 ecx, word32 ebx, word32 edi)
{
	word32 esp_7;
	word32 eax_8;
	word32 ebx_9;
	byte SZO_10;
	byte C_11;
	word32 edi_12;
	word32 ecx_13;
	fn0E8F6B5B();
	return eax_8;
}

// 00414059: Register Eq_15 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetLastError();
	GetCommandLineA();
	GetCommandLineA();
	ptr32 esp_154 = fp + ~0x43;
l00414071:
	HANDLE * esp_28 = esp_154 - 0x04;
	*esp_28 = (HANDLE *) null;
	*(esp_28 - 0x04) = 0x0181;
	*(esp_28 - 0x08) = 0x03;
	*(esp_28 - 0x0C) = 0x00;
	*(esp_28 - 0x10) = 0x04;
	*(esp_28 - 0x14) = 0x80000000;
	*(esp_28 - 0x18) = 0x0042E037;
	Eq_77 eax_42 = CreateFileW(*(esp_28 - 0x18), *(esp_28 - 0x14), *(esp_28 - 0x10), *(esp_28 - 0x0C), *(esp_28 - 0x08), *(esp_28 - 0x04), *esp_28);
	if (eax_42 != (void *) ~0x00)
	{
		*(esp_28 - 0x1C) = 0x00401000;
		*(esp_28 - 0x20) = 0x00;
		*(esp_28 - 0x24) = 0x0182;
		*(esp_28 - 0x28) = 0x03;
		*(esp_28 - 44) = 0x00;
		*(esp_28 - 0x30) = 0x05;
		*(esp_28 - 0x34) = 0x20000000;
		*(esp_28 - 0x38) = 0x0042E000;
		Eq_77 eax_312 = CreateFileW(*(esp_28 - 0x38), *(esp_28 - 0x34), *(esp_28 - 0x30), *(esp_28 - 44), *(esp_28 - 0x28), *(esp_28 - 0x24), *(esp_28 - 0x20));
		VirtualProtect(*(esp_28 - 0x38), *(esp_28 - 0x34), *(esp_28 - 0x30), *(esp_28 - 44));
		*(esp_28 - 0x3C) = (HANDLE *) eax_312;
		GetFileType(*(esp_28 - 0x3C));
		GetLastError();
		*(esp_28 - 0x40) = 0x00401000;
		GetCommandLineA();
		*(esp_28 - 0x44) = dwLoc1C;
		*(esp_28 - 0x48) = (HANDLE *) dwLoc34;
		GetFileType(*(esp_28 - 0x48));
		*(esp_28 - 0x4C) = 77889;
		GetLastError();
		*(esp_28 - 0x50) = 0x00;
		*(esp_28 - 0x54) = 0xA7;
		*(esp_28 - 88) = 0x03;
		*(esp_28 - 0x5C) = 0x00;
		*(esp_28 - 0x60) = 0x01;
		*(esp_28 - 100) = 0x20000000;
		*(esp_28 - 0x68) = 0x0042E097;
		Eq_77 eax_349 = CreateFileA(*(esp_28 - 0x68), *(esp_28 - 100), *(esp_28 - 0x60), *(esp_28 - 0x5C), *(esp_28 - 88), *(esp_28 - 0x54), *(esp_28 - 0x50));
		*(esp_28 - 0x6C) = 0x00;
		*(esp_28 - 0x70) = (HANDLE *) dwLoc44;
		GetFileSize(*(esp_28 - 0x70), *(esp_28 - 0x6C));
		*(esp_28 - 116) = (HANDLE *) eax_349;
		Eq_15 eax_365 = GetFileType(*(esp_28 - 116));
		word32 esp_366;
		word32 ebp_367;
		byte SCZO_368;
		word32 eax_369;
		byte Z_370;
		byte SZO_371;
		byte C_372;
		word32 ecx_373;
		word32 ebx_374;
		word32 edi_375;
		(dwLoc1C + 4275553)();
		return fn00401023(eax_369, ecx_373, ebx_374, edi_375);
	}
	else
	{
		*(esp_28 - 0x1C) = 0x00;
		*(esp_28 - 0x20) = (HANDLE *) eax_42;
		struct Eq_356 * esp_173 = esp_28 - 0x20;
l004140AD:
		GetFileSize(esp_173->t0000, esp_173->t0004);
		HANDLE * esp_85 = esp_173 - 0x04;
		*esp_85 = (HANDLE *) null;
		*(esp_85 - 0x04) = 0x01A3;
		*(esp_85 - 0x08) = 0x03;
		*(esp_85 - 0x0C) = 0x00;
		*(esp_85 - 0x10) = 0x07;
		*(esp_85 - 0x14) = 0x20000000;
		*(esp_85 - 0x18) = 4382899;
		CreateFileA(*(esp_85 - 0x18), *(esp_85 - 0x14), *(esp_85 - 0x10), *(esp_85 - 0x0C), *(esp_85 - 0x08), *(esp_85 - 0x04), *esp_85);
		*(esp_85 - 0x1C) = 0x00;
		ptr32 esp_101 = esp_85 - 0x1C;
		do
		{
			struct Eq_440 * esp_108 = esp_101 - 0x04;
			esp_108->t0000 = 0xA3;
			*(esp_108 - 0x04) = 0x03;
			*(esp_108 - 0x08) = 0x00;
			*(esp_108 - 0x0C) = 0x07;
			*(esp_108 - 0x10) = 0xA0000000;
			*(esp_108 - 0x14) = 0x0042E009;
			Eq_77 eax_120 = CreateFileA(*(esp_108 - 0x14), *(esp_108 - 0x10), *(esp_108 - 0x0C), *(esp_108 - 0x08), *(esp_108 - 0x04), esp_108->t0000, esp_108->t0004);
			*(esp_108 - 0x18) = 0x00;
			*(esp_108 - 0x1C) = 0x0125;
			*(esp_108 - 0x20) = 0x03;
			*(esp_108 - 0x24) = 0x00;
			*(esp_108 - 0x28) = 0x00;
			*(esp_108 - 44) = 0x60000000;
			*(esp_108 - 0x30) = 0x0042E03E;
			Eq_77 eax_136 = CreateFileA(*(esp_108 - 0x30), *(esp_108 - 44), *(esp_108 - 0x28), *(esp_108 - 0x24), *(esp_108 - 0x20), *(esp_108 - 0x1C), *(esp_108 - 0x18));
			*(esp_108 - 0x34) = (HANDLE *) eax_120;
			GetFileType(*(esp_108 - 0x34));
			*(esp_108 - 0x38) = 0x00;
			*(esp_108 - 0x3C) = 0x0122;
			*(esp_108 - 0x40) = 0x03;
			*(esp_108 - 0x44) = 0x00;
			*(esp_108 - 0x48) = 0x06;
			*(esp_108 - 0x4C) = 0xE0000000;
			*(esp_108 - 0x50) = 4382943;
			dwLoc44 = eax_120;
			esp_154 = esp_108 - 0x50;
			Eq_77 eax_156 = CreateFileA(*(esp_108 - 0x50), *(esp_108 - 0x4C), *(esp_108 - 0x48), *(esp_108 - 0x44), *(esp_108 - 0x40), *(esp_108 - 0x3C), *(esp_108 - 0x38));
			if (eax_156 != (void *) ~0x00)
				goto l00414071;
			GetLastError();
			*(esp_108 - 0x54) = 0x00;
			*(esp_108 - 88) = 0x01A5;
			*(esp_108 - 0x5C) = 0x03;
			*(esp_108 - 0x60) = 0x00;
			*(esp_108 - 100) = 0x01;
			*(esp_108 - 0x68) = 0x60000000;
			*(esp_108 - 0x6C) = 0x0042E0D4;
			Eq_77 eax_175 = CreateFileA(*(esp_108 - 0x6C), *(esp_108 - 0x68), *(esp_108 - 100), *(esp_108 - 0x60), *(esp_108 - 0x5C), *(esp_108 - 88), *(esp_108 - 0x54));
			esp_173 = esp_108 - 0x6C;
			dwLoc34 = eax_175;
			if (eax_175 != (void *) ~0x00)
				goto l004140AD;
			*(esp_108 - 0x70) = (HANDLE *) eax_175;
			CloseHandle(*(esp_108 - 0x70));
			*(esp_108 - 116) = 0x0042E08C;
			*(esp_108 - 0x78) = 0x00;
			*(esp_108 - 0x7C) = (HANDLE *) eax_136;
			GetFileSize(*(esp_108 - 0x7C), *(esp_108 - 0x78));
			*(esp_108 - 0x80) = (HANDLE *) eax_156;
			CloseHandle(*(esp_108 - 0x80));
			Eq_674 eax_195 = LoadLibraryA(*(esp_108 - 0x80));
			GetCommandLineA();
			*(esp_108 - 0x84) = 0x0042E0C4;
			*(esp_108 - 0x88) = (HMODULE *) eax_195;
			*(esp_108 - 0x8C) = (HANDLE *) eax_175;
			CloseHandle(*(esp_108 - 0x8C));
			Eq_709 eax_207 = GetProcAddress(*(esp_108 - 0x8C), *(esp_108 - 0x88));
			GetCommandLineA();
			GetCommandLineA();
			*(esp_108 - 0x90) = 0x00;
			*(esp_108 - 0x94) = (HANDLE *) eax_42;
			GetFileSize(*(esp_108 - 0x94), *(esp_108 - 0x90));
			GetLastError();
			*(esp_108 - 0x98) = 0x00;
			*(esp_108 - 0x9C) = 0x86;
			*(esp_108 - 0xA0) = 0x03;
			*(esp_108 - 0xA4) = 0x00;
			*(esp_108 - 0xA8) = 0x05;
			*(esp_108 - 0xAC) = 0xE0000000;
			*(esp_108 - 0xB0) = 4382835;
			esp_101 = esp_108 - 0xB0;
		} while (CreateFileA(*(esp_108 - 0xB0), *(esp_108 - 0xAC), *(esp_108 - 0xA8), *(esp_108 - 0xA4), *(esp_108 - 0xA0), *(esp_108 - 0x9C), *(esp_108 - 0x98)) != (void *) ~0x00);
		int32 eax_249 = eax_207();
		GetLastError();
		*(esp_108 - 0xB4) = 0x00;
		*(esp_108 - 0xB8) = 0x0183;
		*(esp_108 - 188) = 0x03;
		*(esp_108 - 0xC0) = 0x00;
		*(esp_108 - 0xC4) = 0x01;
		*(esp_108 - 200) = 0x60000000;
		*(esp_108 - 0xCC) = 4382812;
		CreateFileW(*(esp_108 - 0xCC), *(esp_108 - 200), *(esp_108 - 0xC4), *(esp_108 - 0xC0), *(esp_108 - 188), *(esp_108 - 0xB8), *(esp_108 - 0xB4));
		*(esp_108 - 0xD0) = (HANDLE *) eax_175;
		Eq_15 eax_285 = GetFileType(*(esp_108 - 0xD0));
		word32 esp_286;
		word32 ebp_287;
		byte SCZO_288;
		Eq_15 eax_289;
		byte Z_290;
		byte SZO_291;
		byte C_292;
		word32 ecx_293;
		word32 ebx_294;
		word32 edi_295;
		(*((word32) (eax_249 ^ 0x06BD) + 0x004142C9))();
		return eax_289;
	}
}

