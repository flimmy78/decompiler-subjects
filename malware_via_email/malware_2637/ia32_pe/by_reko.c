// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401023: void fn00401023(Register byte al, Register word16 dx, Register byte bl, Register word32 esi)
void fn00401023(byte al, word16 dx, byte bl, word32 esi)
{
	byte al_5;
	__daa(al, &al_5);
	__outb(dx, al_5);
}

// 0040F7A3: Register Eq_18 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	struct Eq_19 * esp_100 = fp - 0x5C;
	bool Z_105 = cond(CreateFileA(&globals->t43388F, 0x80000000, 0x07, null, 0x03, 33, null) - (void *) ~0x00);
	do
	{
		ptr32 esp_125;
		struct Eq_262 * esp_145;
		Eq_32 eax_230;
		<anonymous> * dwLoc18_173;
		struct Eq_19 * esp_266;
		if (!Z_418)
		{
			LPCSTR * esp_387 = esp_266 - 0x04;
			*esp_387 = (LPCSTR *) &globals->t433800;
			Eq_163 eax_389 = GetModuleHandleA(*esp_387);
			GetCommandLineA();
			GetCommandLineA();
			*(esp_387 - 0x04) = 4405373;
			GetCommandLineA();
			*(esp_387 - 0x08) = (HMODULE *) eax_389;
			GetLastError();
			dwLoc40 = GetProcAddress(*(esp_387 - 0x08), *(esp_387 - 0x04));
			*(esp_387 - 0x0C) = 0x00;
			*(esp_387 - 0x10) = 0x00;
			*(esp_387 - 0x14) = 0x00;
			*(esp_387 - 0x18) = 0x00;
			*(esp_387 - 0x1C) = 288;
			*(esp_387 - 0x20) = 0x03;
			*(esp_387 - 0x24) = 0x00;
			*(esp_387 - 0x28) = 0x06;
			esp_125 = esp_387 - 0x28;
l0040F82F:
			struct Eq_552 * esp_368 = esp_125 - 0x04;
			esp_368->t0000 = 0x60000000;
			*(esp_368 - 0x04) = 0x0043383F;
			CreateFileA(*(esp_368 - 0x04), esp_368->t0000, esp_368->t0004, esp_368->t0008, esp_368->t000C, esp_368->t0010, esp_368->t0014);
			Eq_18 eax_374 = GetLastError();
			word32 ebp_377;
			byte SCZO_378;
			byte Z_380;
			byte SZO_381;
			byte C_382;
			byte al_383;
			word16 dx_384;
			byte bl_385;
			word32 esi_386;
			dwLoc40();
l0040F84F:
			GetLastError();
			GetCommandLineA();
			HANDLE * esp_340 = esp_145 - 0x04;
			*esp_340 = (HANDLE *) null;
			*(esp_340 - 0x04) = 0x87;
			*(esp_340 - 0x08) = 0x03;
			*(esp_340 - 0x0C) = 0x00;
			*(esp_340 - 0x10) = 0x00;
			*(esp_340 - 0x14) = 0x60000000;
			*(esp_340 - 0x18) = 0x0043382D;
			CreateFileA(*(esp_340 - 0x18), *(esp_340 - 0x14), *(esp_340 - 0x10), *(esp_340 - 0x0C), *(esp_340 - 0x08), *(esp_340 - 0x04), *esp_340);
			dwLoc10 = eax_230;
			dwLoc18_173 = (eax_230 ^ 0xC0000005) + 0x0040F8B2;
l0040F8A1:
			Eq_173 eax_283 = GetCommandLineA();
			ptr32 esp_284;
			word32 ebp_285;
			byte SCZO_286;
			word32 eax_287;
			byte Z_288;
			byte SZO_289;
			byte C_290;
			byte al_291;
			word16 dx_292;
			byte bl_293;
			word32 esi_294;
			dwLoc18_173();
			*(esp_284 - 0x04) = 0x00;
			*(esp_284 - 0x08) = 0x0182;
			*(esp_284 - 0x0C) = 0x03;
			*(esp_284 - 0x10) = 0x00;
			*(esp_284 - 0x14) = 0x01;
			*(esp_284 - 0x18) = 0xC0000000;
			*(esp_284 - 0x1C) = 4405334;
			esp_145 = esp_284 - 0x1C;
l0040F8CF:
			eax_230 = CreateFileA(esp_145->t0000, esp_145->t0004, esp_145->t0008, esp_145->t000C, esp_145->t0010, esp_145->t0014, esp_145->t0018);
			do
			{
				if (eax_230 != (void *) ~0x00)
					goto l0040F84F;
				ptr32 * esp_240 = esp_145 - 0x04;
				*esp_240 = fp - 0x34;
				*(esp_240 - 0x04) = 0x00;
				*(esp_240 - 0x08) = 0x22;
				*(esp_240 - 0x0C) = 0x03;
				*(esp_240 - 0x10) = 0x00;
				*(esp_240 - 0x14) = 0x07;
				*(esp_240 - 0x18) = 0x00;
				*(esp_240 - 0x1C) = 0x0043380A;
				esp_145 = esp_240 - 0x1C;
				eax_230 = CreateFileA(*(esp_240 - 0x1C), *(esp_240 - 0x18), *(esp_240 - 0x14), *(esp_240 - 0x10), *(esp_240 - 0x0C), *(esp_240 - 0x08), *(esp_240 - 0x04));
			} while (eax_230 != (void *) ~0x00);
			*(esp_240 - 0x20) = 0x40;
			GetLastError();
			*(esp_240 - 0x24) = 58535;
			*(esp_240 - 0x28) = 0x00401000;
			GetCommandLineA();
			esp_266 = esp_240 - 0x28;
		}
		VirtualProtect(esp_266->t0000, esp_266->t0004, esp_266->t0008, esp_266->t000C);
		HANDLE * esp_88 = esp_266 - 0x04;
		*esp_88 = (HANDLE *) null;
		*(esp_88 - 0x04) = 0x01A2;
		*(esp_88 - 0x08) = 0x03;
		*(esp_88 - 0x0C) = 0x00;
		*(esp_88 - 0x10) = 0x01;
		*(esp_88 - 0x14) = 0xC0000000;
		*(esp_88 - 0x18) = 0x004337EE;
		Eq_32 eax_102 = CreateFileW(*(esp_88 - 0x18), *(esp_88 - 0x14), *(esp_88 - 0x10), *(esp_88 - 0x0C), *(esp_88 - 0x08), *(esp_88 - 0x04), *esp_88);
		esp_100 = esp_88 - 0x18;
		Z_105 = cond(eax_102 - (void *) ~0x00);
		bool Z_418 = Z_105;
		esp_266 = esp_100;
	} while (eax_102 != (void *) ~0x00);
	*(esp_88 - 0x1C) = (HANDLE *) dwLoc10;
	*(esp_88 - 0x20) = 58535;
	*(esp_88 - 0x24) = 0x00;
	*(esp_88 - 0x28) = 0x0123;
	*(esp_88 - 44) = 0x03;
	*(esp_88 - 0x30) = 0x00;
	*(esp_88 - 0x34) = 0x05;
	*(esp_88 - 0x38) = 0x00;
	*(esp_88 - 0x3C) = 0x0043381C;
	esp_125 = esp_88 - 0x3C;
	if (CreateFileA(*(esp_88 - 0x3C), *(esp_88 - 0x38), *(esp_88 - 0x34), *(esp_88 - 0x30), *(esp_88 - 44), *(esp_88 - 0x28), *(esp_88 - 0x24)) == (void *) ~0x00)
	{
		*(esp_88 - 0x40) = 0x00401000;
		*(esp_88 - 0x44) = 0x00;
		*(esp_88 - 0x48) = 0x0185;
		*(esp_88 - 0x4C) = 0x03;
		*(esp_88 - 0x50) = 0x00;
		*(esp_88 - 0x54) = 0x02;
		*(esp_88 - 88) = 0x80000000;
		*(esp_88 - 0x5C) = 4405204;
		esp_145 = esp_88 - 0x5C;
		if (CreateFileW(*(esp_88 - 0x5C), *(esp_88 - 88), *(esp_88 - 0x54), *(esp_88 - 0x50), *(esp_88 - 0x4C), *(esp_88 - 0x48), *(esp_88 - 0x44)) == (void *) ~0x00)
		{
			GetLastError();
			*(esp_88 - 0x60) = 0x00;
			*(esp_88 - 100) = 0x01A1;
			*(esp_88 - 0x68) = 0x03;
			*(esp_88 - 0x6C) = 0x00;
			*(esp_88 - 0x70) = 0x04;
			*(esp_88 - 116) = 0x40000000;
			*(esp_88 - 0x78) = 4405353;
			CreateFileW(*(esp_88 - 0x78), *(esp_88 - 116), *(esp_88 - 0x70), *(esp_88 - 0x6C), *(esp_88 - 0x68), *(esp_88 - 100), *(esp_88 - 0x60));
			*(esp_88 - 0x7C) = 0x00;
			*(esp_88 - 0x80) = 161;
			*(esp_88 - 0x84) = 0x03;
			*(esp_88 - 0x88) = 0x00;
			*(esp_88 - 0x8C) = 0x05;
			*(esp_88 - 0x90) = 0xC0000000;
			*(esp_88 - 0x94) = 0x00433872;
			ptr32 v13_154 = dwLoc10 - 0xC0000005;
			dwLoc18_173 = v13_154 + 0x0040F76B;
			if (CreateFileW(*(esp_88 - 0x94), *(esp_88 - 0x90), *(esp_88 - 0x8C), *(esp_88 - 0x88), *(esp_88 - 0x84), *(esp_88 - 0x80), *(esp_88 - 0x7C)) == (void *) ~0x00)
			{
				Eq_173 eax_192 = GetCommandLineA();
				word32 esp_194;
				word32 ebp_195;
				byte SCZO_196;
				Eq_18 eax_197;
				byte Z_198;
				byte SZO_199;
				byte C_200;
				byte al_201;
				word16 dx_202;
				byte bl_203;
				word32 esi_204;
				(v13_154 + 0x0040F76B)();
				fn00401023(al_201, dx_202, bl_203, esi_204);
				return eax_197;
			}
			goto l0040F8A1;
		}
		goto l0040F8CF;
	}
	goto l0040F82F;
}

