//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2018 Retargetable Decompiler <info@retdec.com>
//

#include <stdint.h>
#include <stdlib.h>
#include <windows.h>

// ------------------------ Structures ------------------------

struct _EXCEPTION_POINTERS {
    struct _EXCEPTION_RECORD * e0;
    struct _CONTEXT * e1;
};

struct _EXCEPTION_RECORD {
    int32_t e0;
    int32_t e1;
    struct _EXCEPTION_RECORD * e2;
    char * e3;
    int32_t e4;
    int32_t e5[1];
};

struct _M128A {
    int64_t e0;
    int64_t e1;
};

struct _CONTEXT {
    int64_t e0;
    int64_t e1;
    int64_t e2;
    int64_t e3;
    int64_t e4;
    int64_t e5;
    int32_t e6;
    int32_t e7;
    int16_t e8;
    int16_t e9;
    int16_t e10;
    int16_t e11;
    int16_t e12;
    int16_t e13;
    int32_t e14;
    int64_t e15;
    int64_t e16;
    int64_t e17;
    int64_t e18;
    int64_t e19;
    int64_t e20;
    int64_t e21;
    int64_t e22;
    int64_t e23;
    int64_t e24;
    int64_t e25;
    int64_t e26;
    int64_t e27;
    int64_t e28;
    int64_t e29;
    int64_t e30;
    int64_t e31;
    int64_t e32;
    int64_t e33;
    int64_t e34;
    int64_t e35;
    int64_t e36;
    int64_t e37;
    int32_t e38;
    struct _M128A e39[26];
    int64_t e40;
    int64_t e41;
    int64_t e42;
    int64_t e43;
    int64_t e44;
    int64_t e45;
};

struct vtable_403798_type {
    int32_t (*e0)();
};

// ------------------------- Classes --------------------------

// A
// B
// C (base classes: B, A, Z)
// Z
// type_info

// ------------------- Function Prototypes --------------------

void entry_point(void);
int32_t function_401000(char a1, int32_t a2, int32_t a3);
int32_t function_401355(int32_t a1);
int32_t function_4013ac(int32_t a1);
void function_4013b2(void);
int32_t function_4013c5(int32_t a1, int32_t a2, int32_t a3);
int32_t function_4015e0(int32_t a1);
int32_t (**function_4017b9(void))(struct _EXCEPTION_POINTERS *);
void function_4017c8(void);
int32_t function_4018d8(void);
void function_401925(void);
void function_401974(void);
int32_t function_401a3d(int32_t (***a1)());
int32_t function_401ace(void);
int32_t function_401b1d(int32_t a1);
int32_t function_401b27(void);
void function_401b2a(void);
int32_t (**function_401bcb(void (****a1)()))();
int32_t function_401bfa(void);
int32_t function_401d12(void);
int32_t unknown_40622c(void);
int32_t unknown_406238(void);

// --------------------- Global Variables ---------------------

int32_t g1 = 0; // eax
int32_t g2 = 0; // ecx
void (**g3)() = (void (**)())-0x47a90075; // 0x4018b2
char * g4 = "\x33\xc0\xc3\x33\xc0\xc3\xff\x25\xf8\x61\x40"; // 0x401b24
int32_t g6 = -2; // 0x405070
int32_t g7 = 1; // 0x405074
int32_t g8 = 0; // 0x405190
char *** g9 = NULL; // 0x405194
char *** g10 = NULL; // 0x405198
int32_t g11 = 0; // 0x40519c
int32_t g12 = 0; // 0x4051a0
int32_t g13 = 0; // 0x4051a4
int32_t g14 = 0; // 0x4051b0
int32_t g15 = 0; // 0x4051b4
int32_t g16 = 0; // 0x4051b8
int32_t g17 = 0; // 0x4051bc
int32_t g18 = 0; // 0x4054f8
int32_t g19 = 0; // 0x405508
struct vtable_403798_type g5 = {
    .e0 = function_401360
}; // 0x403798

// ------------------------ Functions -------------------------

// Address range: 0x401000 - 0x401354
int32_t function_401000(char a1, int32_t a2, int32_t a3) {
    // 0x401000
    return g2 - 12;
}

// Address range: 0x401355 - 0x40135f
// From class:    type_info
// Type:          constructor
int32_t function_401355(int32_t a1) {
    // 0x401355
    *(int32_t *)g2 = (int32_t)&g5;
    return g2;
}

// Address range: 0x4013ac - 0x4013b1
int32_t function_4013ac(int32_t a1) {
    // 0x4013ac
    return g2;
}

// Address range: 0x4013b2 - 0x4013c4
void function_4013b2(void) {
    // 0x4013b2
    unknown_406238();
}

// Address range: 0x4013c5 - 0x40140f
int32_t function_4013c5(int32_t a1, int32_t a2, int32_t a3) {
    // 0x4013c5
    atexit((void (**)())&g3);
    g13 = g15;
    int32_t result = __getmainargs(&g8, (char ***)&g10, (char ***)&g9, g14, &g13); // 0x4013f5
    g12 = result;
    if (result <= 0) {
        // 0x401407
        _amsg_exit(8);
        // branch -> 0x40140f
    }
    // 0x40140f
    return result;
}

// Address range: 0x4015e0 - 0x401699
int32_t function_4015e0(int32_t a1) {
    // 0x4015e0
    int32_t v1; // 0x401637_4
    if (*(int16_t *)0x400000 == 0x5a4d) {
        int32_t v2 = *(int32_t *)0x40003c; // 0x4015f2
        if (*(int32_t *)(v2 + 0x400000) == 0x4550) {
            // 0x401603
            if (*(int16_t *)(v2 + 0x400018) == 267) {
                // 0x401611
                int32_t v3;
                if (*(int32_t *)(v2 + 0x400074) >= 15) {
                    // 0x40161a
                    v3 = *(int32_t *)(v2 + 0x4000e8) != 0;
                    // branch -> 0x401627
                } else {
                    v3 = 0;
                }
                // 0x401627
                g11 = v3;
                __set_app_type(1);
                v1 = (int32_t)EncodePointer((char *)-1);
                g18 = v1;
                g19 = v1;
                *(int32_t *)0x634c = g17;
                *(int32_t *)0x6340 = g16;
                _RTC_Initialize();
                function_401b27();
                if (g7 == 0) {
                    // 0x401674
                    __setusermatherr((int32_t)&g4);
                    // branch -> 0x401680
                }
                // 0x401680
                __setdefaultprecision();
                if (g6 == -1) {
                    // 0x40168e
                    _configthreadlocale(-1);
                    // branch -> 0x401697
                }
                // 0x401697
                return 0;
            }
        }
    }
    // 0x401627
    g11 = 0;
    __set_app_type(1);
    v1 = (int32_t)EncodePointer((char *)-1);
    g18 = v1;
    g19 = v1;
    *(int32_t *)0x634c = g17;
    *(int32_t *)0x6340 = g16;
    _RTC_Initialize();
    function_401b27();
    if (g7 == 0) {
        // 0x401674
        __setusermatherr((int32_t)&g4);
        // branch -> 0x401680
    }
    // 0x401680
    __setdefaultprecision();
    if (g6 == -1) {
        // 0x40168e
        _configthreadlocale(-1);
        // branch -> 0x401697
    }
    // 0x401697
    return 0;
}

// Address range: 0x40169a - 0x4016a3
void entry_point(void) {
    // 0x40169a
    __security_init_cookie();
    _qm__qm__qm_();
}

// Address range: 0x4017b9 - 0x4017c7
int32_t (**function_4017b9(void))(struct _EXCEPTION_POINTERS *) {
    // 0x4017b9
    SetUnhandledExceptionFilter((int32_t (**)(struct _EXCEPTION_POINTERS *))0x401777);
    return NULL;
}

// Address range: 0x4017c8 - 0x4017d3
void function_4017c8(void) {
    // 0x4017c8
    unknown_40622c();
}

// Address range: 0x4018d8 - 0x4018ef
int32_t function_4018d8(void) {
    // 0x4018d8
    _cexit();
    return g1;
}

// Address range: 0x401925 - 0x40192f
void function_401925(void) {
    // 0x401925
    return;
}

// Address range: 0x401974 - 0x40197f
void function_401974(void) {
    // 0x401974
    return;
}

// Address range: 0x401a3d - 0x401a4f
int32_t function_401a3d(int32_t (***a1)()) {
    // 0x401a3d
    return _initterm_e(NULL, a1);
}

// Address range: 0x401ace - 0x401ad3
int32_t function_401ace(void) {
    // 0x401ace
    return _configthreadlocale(0);
}

// Address range: 0x401b1d - 0x401b26
int32_t function_401b1d(int32_t a1) {
    // 0x401b1d
    int32_t v1;
    __setusermatherr(v1);
    return g1;
}

// Address range: 0x401b27 - 0x401b29
int32_t function_401b27(void) {
    // 0x401b27
    return 0;
}

// Address range: 0x401b2a - 0x401b2f
void function_401b2a(void) {
    // 0x401b2a
    __set_app_type(0);
}

// Address range: 0x401bcb - 0x401bf9
int32_t (**function_401bcb(void (****a1)()))() {
    // 0x401bcb
    _qm_terminate__YAXXZ((int32_t)a1);
    return (int32_t (**)())g1;
}

// Address range: 0x401bfa - 0x401c0b
int32_t function_401bfa(void) {
    // 0x401bfa
    return _except_handler4_common();
}

// Address range: 0x401d12 - 0x402fdc
int32_t function_401d12(void) {
    // 0x401d12
    _crt_debugger_hook();
    return g1;
}

// --------------- Statically Linked Functions ----------------

// void __cdecl __security_init_cookie(void);
// void __setdefaultprecision(void);
// void _qm__qm__qm_(void);
// void __cdecl _RTC_Initialize(void);
// int atexit(void(* func)(void));

// --------------- Dynamically Linked Functions ---------------

// int __getmainargs(int * Argc, char *** Argv, char *** Env, int DoWildCard, _startupinfo * StartInfo);
// void __set_app_type(int at);
// void __setusermatherr(_HANDLE_MATH_ERROR pf);
// void _amsg_exit(int rterrnum);
// void __cdecl _cexit(void);
// int __cdecl _configthreadlocale(_In_ int Flag);
// void _crt_debugger_hook(void);
// int _except_handler4_common(void);
// int __cdecl _initterm_e(_PIFV * First, _In_ _PIFV * Last);
// void _qm_terminate__YAXXZ(int32_t a1);
// PVOID EncodePointer(_In_opt_ PVOID Ptr);
// LPTOP_LEVEL_EXCEPTION_FILTER SetUnhandledExceptionFilter(_In_opt_ LPTOP_LEVEL_EXCEPTION_FILTER lpTopLevelExceptionFilter);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: microsoft linker (10.0)
// Detected functions: 20
// Decompiler release: VERSION
// Decompilation date: DATE
